import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChild, ContentChildren, ElementRef, forwardRef, HostBinding, Input, TemplateRef, ViewChild, QueryList, EventEmitter, Output, } from '@angular/core';
import { NgModel, NG_VALUE_ACCESSOR } from '@angular/forms';
import { MatAutocompleteTrigger } from '@angular/material/autocomplete';
import { debounceTime, takeUntil, switchMap, tap, filter } from 'rxjs/operators';
import { Subject } from 'rxjs';
import { trim, random, isObject } from 'lodash-es';
import { FsAutocompleteTemplateDirective } from '../../directives/autocomplete-template/autocomplete-template.directive';
import { FsAutocompleteSuffixDirective } from '../../directives/autocomplete-suffix/autocomplete-suffix.directive';
import { FsAutocompleteStaticDirective } from '../../directives/autocomplete-static/autocomplete-static.directive';
import { FsAutocompleteNoResultsDirective } from '../../directives/no-results-template/no-results-template.directive';
import { FsAutocompleteHintDirective } from '../../directives/autocomplete-hint/autocomplete-hint.directive';
import * as i0 from "@angular/core";
import * as i1 from "@angular/material/form-field";
import * as i2 from "@angular/material/icon";
import * as i3 from "@angular/material/autocomplete";
import * as i4 from "@angular/material/core";
import * as i5 from "@angular/material/input";
import * as i6 from "@angular/forms";
import * as i7 from "@angular/common";
export class FsAutocompleteComponent {
    constructor(_cdRef) {
        this._cdRef = _cdRef;
        this.template = null;
        this.staticTemplates = null;
        this.noResultsTemplate = null;
        this.suffix = null;
        this.hintTemplate = null;
        this.formWrapper = true;
        this.fetch = null;
        this.placeholder = '';
        this.displayWith = null;
        this.fetchOnFocus = false;
        this.readonly = false;
        this.required = false;
        this.disabled = false;
        this.hint = null;
        this.panelWidth = null;
        this.cleared = new EventEmitter();
        this.data = [];
        this.keyword = '';
        this.panelClasses = ['fs-autocomplete-panel'];
        this.noResults = false;
        this.name = 'autocomplete_'.concat(random(1, 9999999));
        this.model = null;
        this.searching = false;
        this._showClear = true;
        this._destroy$ = new Subject();
        this._keyword$ = new Subject();
        this._ignoreKeys = [
            'Enter', 'Escape', 'ArrowUp', 'ArrowLeft', 'ArrowRight',
            'ArrowDown', 'Alt', 'Control', 'Shift',
        ];
        this._onTouched = () => { };
        this._onChange = (value) => { };
        this.display = (data) => {
            if (data && this.displayWith) {
                return this.displayWith(data);
            }
            return '';
        };
    }
    set setPanelClass(value) {
        this.panelClasses.push(value);
    }
    set showClear(value) {
        this._showClear = value;
        this._cdRef.detectChanges();
    }
    get showClear() {
        return this._showClear;
    }
    registerOnChange(fn) { this._onChange = fn; }
    registerOnTouched(fn) { this._onTouched = fn; }
    ngOnInit() {
        // Because the input display is set natively the delay
        // ensure its set after this.keyword
        setTimeout(() => {
            this._updateKeywordDisplay();
        });
        // _setValueAndClose() override to change the order of focus() and _onChange()
        const autocompleteTrigger = this.autocomplete;
        autocompleteTrigger._setValueAndClose = (event) => {
            if (event && event.source) {
                if (event.source.value.staticOptionIndex === undefined) {
                    autocompleteTrigger._clearPreviousSelectedOption(event.source);
                    autocompleteTrigger._setTriggerValue(event.source.value);
                    autocompleteTrigger._onChange(event.source.value);
                }
                autocompleteTrigger.autocomplete._emitSelectEvent(event.source);
            }
            autocompleteTrigger.closePanel();
        };
        this._keyword$
            .pipe(debounceTime(150), filter((event) => {
            return !event || this._ignoreKeys.indexOf(event.key) === -1;
        }), switchMap((event) => {
            this.data = [];
            this.searching = true;
            this._cdRef.markForCheck();
            return this.fetch(trim(event.target.value))
                .pipe(tap((response) => {
                this.data = response;
                this.noResults = !response.length;
                this._cdRef.markForCheck();
                this.autocomplete.openPanel();
                this.searching = false;
            }), takeUntil(this._destroy$));
        }), takeUntil(this._destroy$))
            .subscribe(() => {
            this._onTouched();
        });
    }
    load() {
        this.searching = true;
        this._keyword$.next({ target: { value: this._getKeyword() } });
    }
    focus() {
        this.keywordInput.nativeElement.focus();
    }
    inputFocus(e) {
        if (this.readonly || this.disabled) {
            return;
        }
        if (this.fetchOnFocus) {
            if (!this.model) {
                this.load();
            }
        }
    }
    inputBlur() {
        if (this.readonly || this.disabled) {
            return;
        }
        setTimeout(() => {
            if (!this.model) {
                this.clearKeyword();
            }
            this._updateKeywordDisplay();
            this.clearResults();
        }, 200);
    }
    select(value) {
        if (isObject(value) && value.staticOptionIndex !== undefined) {
            this.staticSelect(value.staticOptionIndex);
        }
        else {
            this.model = value;
            this.data = [];
            this._updateKeywordDisplay();
            this._onChange(value);
        }
        this.clearResults();
    }
    optionSelected(event) {
        this.select(event.option.value);
        this.autocomplete.closePanel();
    }
    close() {
        this.autocomplete.closePanel();
    }
    writeValue(value) {
        this.model = value;
        this._updateKeywordDisplay();
    }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    input(event) {
        if (this.readonly || this.disabled) {
            return;
        }
        if (!event.target.value.length) {
            return this.clear();
        }
        this._keyword$.next(event);
    }
    keyDown(event) {
        if (this.readonly || this.disabled) {
            return;
        }
        if (event.code === 'Tab') {
            if (!this.model && this.autocomplete.activeOption) {
                this.keyword = 'dummy';
                this.select(this.autocomplete.activeOption.value);
            }
        }
        else if (event.code === 'Backspace') {
            if (this.model) {
                this.model = null;
                this.clearKeyword();
            }
        }
        else if (!this._isWindows() && !this._isMacOS()) {
            if (this._ignoreKeys.indexOf(event.key) === -1) {
                this.searching = true;
                this.data = [];
                if (this.model) {
                    this.clear();
                }
            }
        }
    }
    keyUp(event) {
        if (this.readonly || this.disabled) {
            return;
        }
        if (event.code === 'Backspace' && !event.target.value.length) {
            this.clear();
            this.load();
        }
    }
    staticSelect(index) {
        if (!this.model) {
            this.keywordNgModel.reset();
        }
        const staticDirective = this.staticDirectives.toArray()[index];
        staticDirective.selected.emit();
    }
    ngOnDestroy() {
        this._destroy$.next();
        this._destroy$.complete();
    }
    clearResults(closePanel = true) {
        this.data = [];
        this.noResults = false;
        if (closePanel) {
            this.autocomplete.closePanel();
        }
    }
    clear(closePanel = true) {
        this.model = null;
        this.clearResults(closePanel);
        this.clearKeyword();
        this._onChange(null);
    }
    clearKeyword() {
        this.keyword = null;
        this._updateKeywordDisplay();
    }
    clearClick(event) {
        event.stopPropagation();
        this.clear(false);
        this.keywordInput.nativeElement.focus();
        this.cleared.emit();
    }
    _updateKeywordDisplay() {
        const value = this.model ? this.display(this.model) : '';
        this.keyword = this.model;
        this.keywordInput.nativeElement.value = value;
        this._cdRef.markForCheck();
    }
    _getKeyword() {
        return this.keywordInput.nativeElement.value;
    }
    _isMacOS() {
        return navigator.platform.indexOf('Mac') > -1;
    }
    _isWindows() {
        return navigator.platform.indexOf('Win') > -1;
    }
}
FsAutocompleteComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsAutocompleteComponent, deps: [{ token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
FsAutocompleteComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: FsAutocompleteComponent, selector: "fs-autocomplete", inputs: { fetch: "fetch", placeholder: "placeholder", displayWith: "displayWith", fetchOnFocus: "fetchOnFocus", readonly: "readonly", required: "required", disabled: "disabled", hint: "hint", panelWidth: "panelWidth", setPanelClass: ["panelClass", "setPanelClass"], showClear: "showClear" }, outputs: { cleared: "cleared" }, host: { properties: { "class.fs-form-wrapper": "this.formWrapper" } }, providers: [
        {
            provide: NG_VALUE_ACCESSOR,
            useExisting: forwardRef(() => FsAutocompleteComponent),
            multi: true
        }
    ], queries: [{ propertyName: "template", first: true, predicate: FsAutocompleteTemplateDirective, descendants: true, read: TemplateRef, static: true }, { propertyName: "noResultsTemplate", first: true, predicate: FsAutocompleteNoResultsDirective, descendants: true, read: TemplateRef, static: true }, { propertyName: "suffix", first: true, predicate: FsAutocompleteSuffixDirective, descendants: true, read: TemplateRef, static: true }, { propertyName: "hintTemplate", first: true, predicate: FsAutocompleteHintDirective, descendants: true, read: TemplateRef, static: true }, { propertyName: "staticTemplates", predicate: FsAutocompleteStaticDirective }, { propertyName: "staticDirectives", predicate: FsAutocompleteStaticDirective }], viewQueries: [{ propertyName: "autocomplete", first: true, predicate: MatAutocompleteTrigger, descendants: true, static: true }, { propertyName: "keywordInput", first: true, predicate: ["keywordInput"], descendants: true, static: true }, { propertyName: "keywordNgModel", first: true, predicate: ["keywordNgModel"], descendants: true, static: true }], ngImport: i0, template: "<mat-form-field>\n  <mat-label [attr.data-after-content]=\"placeholder\"></mat-label>\n  <input\n    #keywordInput\n    #keywordNgModel=\"ngModel\"\n    matInput\n    type=\"search\"\n    [(ngModel)]=\"keyword\"\n    [name]=\"name\"\n    [disabled]=\"disabled\"\n    [readonly]=\"readonly\"\n    [required]=\"required\"\n    (focus)=\"inputFocus($event)\"\n    (blur)=\"inputBlur()\"\n    (input)=\"input($event)\"\n    (keydown)=\"keyDown($event)\"\n    (keyup)=\"keyUp($event)\"\n    [matAutocomplete]=\"userAutocompleteInput\">\n\n  <div *ngIf=\"!disabled\" matSuffix>\n    <ng-container\n      [ngTemplateOutlet]=\"suffix\"\n      [ngTemplateOutletContext]=\"{ data: model }\">\n    </ng-container>\n\n    <mat-icon\n      *ngIf=\"showClear && model\"\n      class=\"clear\"\n      (click)=\"clearClick($event)\">clear</mat-icon>\n  </div>\n\n  <mat-autocomplete\n    #userAutocompleteInput=\"matAutocomplete\"\n    [autoActiveFirstOption]=\"true\"\n    [panelWidth]=\"panelWidth\"\n    [class]=\"panelClasses.join(' ')\"\n    [displayWith]=\"display\"\n    (optionSelected)=\"optionSelected($event)\">\n\n    <mat-option *ngFor=\"let item of data\" [value]=\"item\">\n      <ng-container\n        [ngTemplateOutlet]=\"template\"\n        [ngTemplateOutletContext]=\"{ data: item }\">\n      </ng-container>\n    </mat-option>\n\n    <ng-container *ngIf=\"!searching\">\n      <ng-container *ngIf=\"noResults\">\n        <ng-template\n          *ngIf=\"noResultsTemplate; else noResultsOption\"\n          [ngTemplateOutlet]=\"noResultsTemplate\"\n          [ngTemplateOutletContext]=\"{ $implicit: keyword }\">\n        </ng-template>\n        <ng-template #noResultsOption>\n          <mat-option disabled class=\"no-results\">\n            No results <ng-container *ngIf=\"keyword\">for \"{{keyword}}\"</ng-container>\n          </mat-option>\n        </ng-template>\n      </ng-container>\n\n      <ng-container *ngIf=\"!model && (!searching || keyword) && staticTemplates?.length\">\n        <div class=\"static-templates\">\n          <ng-container *ngFor=\"let staticTemplate of staticTemplates; let i = index\">\n            <ng-container *ngIf=\"!staticTemplate.showWhenKeyword || !!keyword\">\n              <mat-option\n                class=\"static-option\"\n                [value]=\"{ staticOptionIndex: i }\"\n                [ngClass]=\"{ 'static-option-first': !i }\">\n                <ng-template\n                  [ngTemplateOutlet]=\"staticTemplate.templateRef\"\n                  [ngTemplateOutletContext]=\"{ $implicit: keyword }\"\n                ></ng-template>\n              </mat-option>\n            </ng-container>\n          </ng-container>\n        </div>\n      </ng-container>\n    </ng-container>\n  </mat-autocomplete>\n\n  <mat-hint *ngIf=\"hint\">{{ hint }}</mat-hint>\n  <mat-hint *ngIf=\"hintTemplate\">\n    <ng-container\n      [ngTemplateOutlet]=\"hintTemplate\">\n    </ng-container>\n  </mat-hint>\n</mat-form-field>\n", styles: ["::ng-deep .fs-autocomplete-panel .static-templates{position:sticky;bottom:0;width:100%;background:#fff;border-top:1px solid #e0e0e0}::ng-deep .fs-autocomplete-panel.mat-autocomplete-hidden{visibility:visible!important}.mat-form-field{width:100%}.clear{cursor:pointer}mat-label:after{content:attr(data-after-content)}:host ::ng-deep .mat-form-field-suffix{align-self:flex-end}\n"], components: [{ type: i1.MatFormField, selector: "mat-form-field", inputs: ["color", "floatLabel", "appearance", "hideRequiredMarker", "hintLabel"], exportAs: ["matFormField"] }, { type: i2.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { type: i3.MatAutocomplete, selector: "mat-autocomplete", inputs: ["disableRipple"], exportAs: ["matAutocomplete"] }, { type: i4.MatOption, selector: "mat-option", exportAs: ["matOption"] }], directives: [{ type: i1.MatLabel, selector: "mat-label" }, { type: i5.MatInput, selector: "input[matInput], textarea[matInput], select[matNativeControl],      input[matNativeControl], textarea[matNativeControl]", inputs: ["id", "disabled", "required", "type", "value", "readonly", "placeholder", "errorStateMatcher", "aria-describedby"], exportAs: ["matInput"] }, { type: i6.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { type: i3.MatAutocompleteTrigger, selector: "input[matAutocomplete], textarea[matAutocomplete]", exportAs: ["matAutocompleteTrigger"] }, { type: i6.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i6.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { type: i6.RequiredValidator, selector: ":not([type=checkbox])[required][formControlName],:not([type=checkbox])[required][formControl],:not([type=checkbox])[required][ngModel]", inputs: ["required"] }, { type: i7.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i1.MatSuffix, selector: "[matSuffix]" }, { type: i7.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet"] }, { type: i7.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i7.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { type: i1.MatHint, selector: "mat-hint", inputs: ["align", "id"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsAutocompleteComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'fs-autocomplete',
                    templateUrl: 'autocomplete.component.html',
                    styleUrls: ['autocomplete.component.scss'],
                    providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(() => FsAutocompleteComponent),
                            multi: true
                        }
                    ],
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }]; }, propDecorators: { autocomplete: [{
                type: ViewChild,
                args: [MatAutocompleteTrigger, { static: true }]
            }], template: [{
                type: ContentChild,
                args: [FsAutocompleteTemplateDirective, { read: TemplateRef, static: true }]
            }], staticTemplates: [{
                type: ContentChildren,
                args: [FsAutocompleteStaticDirective]
            }], staticDirectives: [{
                type: ContentChildren,
                args: [FsAutocompleteStaticDirective]
            }], noResultsTemplate: [{
                type: ContentChild,
                args: [FsAutocompleteNoResultsDirective, { read: TemplateRef, static: true }]
            }], suffix: [{
                type: ContentChild,
                args: [FsAutocompleteSuffixDirective, { read: TemplateRef, static: true }]
            }], hintTemplate: [{
                type: ContentChild,
                args: [FsAutocompleteHintDirective, { read: TemplateRef, static: true }]
            }], formWrapper: [{
                type: HostBinding,
                args: ['class.fs-form-wrapper']
            }], keywordInput: [{
                type: ViewChild,
                args: ['keywordInput', { static: true }]
            }], keywordNgModel: [{
                type: ViewChild,
                args: ['keywordNgModel', { static: true }]
            }], fetch: [{
                type: Input
            }], placeholder: [{
                type: Input
            }], displayWith: [{
                type: Input
            }], fetchOnFocus: [{
                type: Input
            }], readonly: [{
                type: Input
            }], required: [{
                type: Input
            }], disabled: [{
                type: Input
            }], hint: [{
                type: Input
            }], panelWidth: [{
                type: Input
            }], setPanelClass: [{
                type: Input,
                args: ['panelClass']
            }], showClear: [{
                type: Input
            }], cleared: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0b2NvbXBsZXRlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9hcHAvY29tcG9uZW50cy9hdXRvY29tcGxldGUvYXV0b2NvbXBsZXRlLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3NyYy9hcHAvY29tcG9uZW50cy9hdXRvY29tcGxldGUvYXV0b2NvbXBsZXRlLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCx1QkFBdUIsRUFBRSxpQkFBaUIsRUFDMUMsU0FBUyxFQUNULFlBQVksRUFDWixlQUFlLEVBQ2YsVUFBVSxFQUNWLFVBQVUsRUFDVixXQUFXLEVBQ1gsS0FBSyxFQUdMLFdBQVcsRUFDWCxTQUFTLEVBQ1QsU0FBUyxFQUNULFlBQVksRUFDWixNQUFNLEdBQ1AsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUF3QixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVsRixPQUFPLEVBQUUsc0JBQXNCLEVBQWdDLE1BQU0sZ0NBQWdDLENBQUM7QUFHdEcsT0FBTyxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqRixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRS9CLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUVuRCxPQUFPLEVBQUUsK0JBQStCLEVBQUUsTUFBTSx3RUFBd0UsQ0FBQztBQUN6SCxPQUFPLEVBQUUsNkJBQTZCLEVBQUUsTUFBTSxvRUFBb0UsQ0FBQztBQUNuSCxPQUFPLEVBQUUsNkJBQTZCLEVBQUUsTUFBTSxvRUFBb0UsQ0FBQztBQUNuSCxPQUFPLEVBQUUsZ0NBQWdDLEVBQUUsTUFBTSxvRUFBb0UsQ0FBQztBQUN0SCxP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b25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkLFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIEVsZW1lbnRSZWYsXG4gIGZvcndhcmRSZWYsXG4gIEhvc3RCaW5kaW5nLFxuICBJbnB1dCxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIFRlbXBsYXRlUmVmLFxuICBWaWV3Q2hpbGQsXG4gIFF1ZXJ5TGlzdCxcbiAgRXZlbnRFbWl0dGVyLFxuICBPdXRwdXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE5nTW9kZWwsIE5HX1ZBTFVFX0FDQ0VTU09SIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuXG5pbXBvcnQgeyBNYXRBdXRvY29tcGxldGVUcmlnZ2VyLCBNYXRBdXRvY29tcGxldGVTZWxlY3RlZEV2ZW50IH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvYXV0b2NvbXBsZXRlJztcbmltcG9ydCB7IE1hdE9wdGlvblNlbGVjdGlvbkNoYW5nZSB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2NvcmUnO1xuXG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUsIHRha2VVbnRpbCwgc3dpdGNoTWFwLCB0YXAsIGZpbHRlciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgdHJpbSwgcmFuZG9tLCBpc09iamVjdCB9IGZyb20gJ2xvZGFzaC1lcyc7XG5cbmltcG9ydCB7IEZzQXV0b2NvbXBsZXRlVGVtcGxhdGVEaXJlY3RpdmUgfSBmcm9tICcuLi8uLi9kaXJlY3RpdmVzL2F1dG9jb21wbGV0ZS10ZW1wbGF0ZS9hdXRvY29tcGxldGUtdGVtcGxhdGUuZGlyZWN0aXZlJztcbmltcG9ydCB7IEZzQXV0b2NvbXBsZXRlU3VmZml4RGlyZWN0aXZlIH0gZnJvbSAnLi4vLi4vZGlyZWN0aXZlcy9hdXRvY29tcGxldGUtc3VmZml4L2F1dG9jb21wbGV0ZS1zdWZmaXguZGlyZWN0aXZlJztcbmltcG9ydCB7IEZzQXV0b2NvbXBsZXRlU3RhdGljRGlyZWN0aXZlIH0gZnJvbSAnLi4vLi4vZGlyZWN0aXZlcy9hdXRvY29tcGxldGUtc3RhdGljL2F1dG9jb21wbGV0ZS1zdGF0aWMuZGlyZWN0aXZlJztcbmltcG9ydCB7IEZzQXV0b2NvbXBsZXRlTm9SZXN1bHRzRGlyZWN0aXZlIH0gZnJvbSAnLi4vLi4vZGlyZWN0aXZlcy9uby1yZXN1bHRzLXRlbXBsYXRlL25vLXJlc3VsdHMtdGVtcGxhdGUuZGlyZWN0aXZlJztcbmltcG9ydCB7IEZzQXV0b2NvbXBsZXRlSGludERpcmVjdGl2ZSB9IGZyb20gJy4uLy4uL2RpcmVjdGl2ZXMvYXV0b2NvbXBsZXRlLWhpbnQvYXV0b2NvbXBsZXRlLWhpbnQuZGlyZWN0aXZlJztcblxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdmcy1hdXRvY29tcGxldGUnLFxuICB0ZW1wbGF0ZVVybDogJ2F1dG9jb21wbGV0ZS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWyAnYXV0b2NvbXBsZXRlLmNvbXBvbmVudC5zY3NzJyBdLFxuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IEZzQXV0b2NvbXBsZXRlQ29tcG9uZW50KSxcbiAgICAgIG11bHRpOiB0cnVlXG4gICAgfVxuICBdLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgRnNBdXRvY29tcGxldGVDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgT25Jbml0LCBPbkRlc3Ryb3kge1xuXG4gIEBWaWV3Q2hpbGQoTWF0QXV0b2NvbXBsZXRlVHJpZ2dlciwgeyBzdGF0aWM6IHRydWUgfSkgYXV0b2NvbXBsZXRlOiBNYXRBdXRvY29tcGxldGVUcmlnZ2VyO1xuXG4gIEBDb250ZW50Q2hpbGQoRnNBdXRvY29tcGxldGVUZW1wbGF0ZURpcmVjdGl2ZSwgeyByZWFkOiBUZW1wbGF0ZVJlZiwgc3RhdGljOiB0cnVlIH0pXG4gIHB1YmxpYyB0ZW1wbGF0ZTogVGVtcGxhdGVSZWY8RnNBdXRvY29tcGxldGVUZW1wbGF0ZURpcmVjdGl2ZT4gPSBudWxsO1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oRnNBdXRvY29tcGxldGVTdGF0aWNEaXJlY3RpdmUpXG4gIHB1YmxpYyBzdGF0aWNUZW1wbGF0ZXM6IEZzQXV0b2NvbXBsZXRlU3RhdGljRGlyZWN0aXZlW10gPSBudWxsO1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oRnNBdXRvY29tcGxldGVTdGF0aWNEaXJlY3RpdmUpXG4gIHB1YmxpYyBzdGF0aWNEaXJlY3RpdmVzOiBRdWVyeUxpc3Q8RnNBdXRvY29tcGxldGVTdGF0aWNEaXJlY3RpdmU+O1xuXG4gIEBDb250ZW50Q2hpbGQoRnNBdXRvY29tcGxldGVOb1Jlc3VsdHNEaXJlY3RpdmUsIHsgcmVhZDogVGVtcGxhdGVSZWYsIHN0YXRpYzogdHJ1ZSB9KVxuICBwdWJsaWMgbm9SZXN1bHRzVGVtcGxhdGU6IFRlbXBsYXRlUmVmPEZzQXV0b2NvbXBsZXRlTm9SZXN1bHRzRGlyZWN0aXZlPltdID0gbnVsbDtcblxuICBAQ29udGVudENoaWxkKEZzQXV0b2NvbXBsZXRlU3VmZml4RGlyZWN0aXZlLCB7IHJlYWQ6IFRlbXBsYXRlUmVmLCBzdGF0aWM6IHRydWUgfSlcbiAgcHVibGljIHN1ZmZpeDogVGVtcGxhdGVSZWY8RnNBdXRvY29tcGxldGVTdWZmaXhEaXJlY3RpdmU+ID0gbnVsbDtcblxuICBAQ29udGVudENoaWxkKEZzQXV0b2NvbXBsZXRlSGludERpcmVjdGl2ZSwgeyByZWFkOiBUZW1wbGF0ZVJlZiwgc3RhdGljOiB0cnVlIH0pXG4gIHB1YmxpYyBoaW50VGVtcGxhdGU6IFRlbXBsYXRlUmVmPEZzQXV0b2NvbXBsZXRlSGludERpcmVjdGl2ZT4gPSBudWxsO1xuXG4gIEBIb3N0QmluZGluZygnY2xhc3MuZnMtZm9ybS13cmFwcGVyJykgXG4gIHB1YmxpYyBmb3JtV3JhcHBlciA9IHRydWU7XG5cbiAgQFZpZXdDaGlsZCgna2V5d29yZElucHV0JywgeyBzdGF0aWM6IHRydWUgfSkgXG4gIHB1YmxpYyBrZXl3b3JkSW5wdXQ6IEVsZW1lbnRSZWY7XG5cbiAgQFZpZXdDaGlsZCgna2V5d29yZE5nTW9kZWwnLCB7IHN0YXRpYzogdHJ1ZSB9KSBcbiAgcHVibGljIGtleXdvcmROZ01vZGVsOiBOZ01vZGVsO1xuXG4gIEBJbnB1dCgpIHB1YmxpYyBmZXRjaDogRnVuY3Rpb24gPSBudWxsO1xuICBASW5wdXQoKSBwdWJsaWMgcGxhY2Vob2xkZXIgPSAnJztcbiAgQElucHV0KCkgcHVibGljIGRpc3BsYXlXaXRoOiBGdW5jdGlvbiA9IG51bGw7XG4gIEBJbnB1dCgpIHB1YmxpYyBmZXRjaE9uRm9jdXMgPSBmYWxzZTtcbiAgQElucHV0KCkgcHVibGljIHJlYWRvbmx5ID0gZmFsc2U7XG4gIEBJbnB1dCgpIHB1YmxpYyByZXF1aXJlZCA9IGZhbHNlO1xuICBASW5wdXQoKSBwdWJsaWMgZGlzYWJsZWQgPSBmYWxzZTtcbiAgQElucHV0KCkgcHVibGljIGhpbnQ6IHN0cmluZyA9IG51bGw7XG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBwYW5lbFdpZHRoOiBzdHJpbmcgfCBudW1iZXIgPSBudWxsO1xuXG4gIEBJbnB1dCgncGFuZWxDbGFzcycpXG4gIHNldCBzZXRQYW5lbENsYXNzKHZhbHVlKSB7XG4gICAgdGhpcy5wYW5lbENsYXNzZXMucHVzaCh2YWx1ZSk7XG4gIH1cblxuICBASW5wdXQoKSBwdWJsaWMgc2V0IHNob3dDbGVhcih2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX3Nob3dDbGVhciA9IHZhbHVlO1xuICAgIHRoaXMuX2NkUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgc2hvd0NsZWFyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9zaG93Q2xlYXI7XG4gIH1cblxuICBAT3V0cHV0KCkgcHVibGljIGNsZWFyZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgcHVibGljIGRhdGE6IGFueVtdID0gW107XG4gIHB1YmxpYyBrZXl3b3JkID0gJyc7XG4gIHB1YmxpYyBwYW5lbENsYXNzZXMgPSBbJ2ZzLWF1dG9jb21wbGV0ZS1wYW5lbCddO1xuICBwdWJsaWMgbm9SZXN1bHRzID0gZmFsc2U7XG4gIHB1YmxpYyBuYW1lID0gJ2F1dG9jb21wbGV0ZV8nLmNvbmNhdChyYW5kb20oMSwgOTk5OTk5OSkpO1xuICBwdWJsaWMgbW9kZWwgPSBudWxsO1xuICBwdWJsaWMgc2VhcmNoaW5nID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSBfc2hvd0NsZWFyID0gdHJ1ZTtcbiAgcHJpdmF0ZSBfZGVzdHJveSQgPSBuZXcgU3ViamVjdCgpO1xuICBwcml2YXRlIF9rZXl3b3JkJCA9IG5ldyBTdWJqZWN0KCk7XG4gIHByaXZhdGUgX2lnbm9yZUtleXMgPSBbXG4gICAgJ0VudGVyJywgJ0VzY2FwZScsICdBcnJvd1VwJywgJ0Fycm93TGVmdCcsICdBcnJvd1JpZ2h0JyxcbiAgICAnQXJyb3dEb3duJywgJ0FsdCcsICdDb250cm9sJywgJ1NoaWZ0JyxcbiAgXTtcbiAgcHJpdmF0ZSBfb25Ub3VjaGVkID0gKCkgPT4geyB9O1xuICBwcml2YXRlIF9vbkNoYW5nZSA9ICh2YWx1ZTogYW55KSA9PiB7fTtcblxuICBwdWJsaWMgcmVnaXN0ZXJPbkNoYW5nZShmbjogKHZhbHVlOiBhbnkpID0+IGFueSk6IHZvaWQgeyB0aGlzLl9vbkNoYW5nZSA9IGZuIH1cbiAgcHVibGljIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiAoKSA9PiBhbnkpOiB2b2lkIHsgdGhpcy5fb25Ub3VjaGVkID0gZm4gfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgX2NkUmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgKSB7fVxuXG4gIHB1YmxpYyBuZ09uSW5pdCgpIHtcbiAgICAvLyBCZWNhdXNlIHRoZSBpbnB1dCBkaXNwbGF5IGlzIHNldCBuYXRpdmVseSB0aGUgZGVsYXlcbiAgICAvLyBlbnN1cmUgaXRzIHNldCBhZnRlciB0aGlzLmtleXdvcmRcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuX3VwZGF0ZUtleXdvcmREaXNwbGF5KCk7XG4gICAgfSk7XG5cbiAgICAvLyBfc2V0VmFsdWVBbmRDbG9zZSgpIG92ZXJyaWRlIHRvIGNoYW5nZSB0aGUgb3JkZXIgb2YgZm9jdXMoKSBhbmQgX29uQ2hhbmdlKClcbiAgICBjb25zdCBhdXRvY29tcGxldGVUcmlnZ2VyID0gKDxhbnk+dGhpcy5hdXRvY29tcGxldGUpO1xuICAgIGF1dG9jb21wbGV0ZVRyaWdnZXIuX3NldFZhbHVlQW5kQ2xvc2UgPSAoZXZlbnQ6IE1hdE9wdGlvblNlbGVjdGlvbkNoYW5nZSkgPT4ge1xuICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnNvdXJjZSkge1xuICAgICAgICBpZiAoZXZlbnQuc291cmNlLnZhbHVlLnN0YXRpY09wdGlvbkluZGV4ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBhdXRvY29tcGxldGVUcmlnZ2VyLl9jbGVhclByZXZpb3VzU2VsZWN0ZWRPcHRpb24oZXZlbnQuc291cmNlKTtcbiAgICAgICAgICBhdXRvY29tcGxldGVUcmlnZ2VyLl9zZXRUcmlnZ2VyVmFsdWUoZXZlbnQuc291cmNlLnZhbHVlKTtcbiAgICAgICAgICBhdXRvY29tcGxldGVUcmlnZ2VyLl9vbkNoYW5nZShldmVudC5zb3VyY2UudmFsdWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgYXV0b2NvbXBsZXRlVHJpZ2dlci5hdXRvY29tcGxldGUuX2VtaXRTZWxlY3RFdmVudChldmVudC5zb3VyY2UpO1xuICAgICAgfVxuXG4gICAgICBhdXRvY29tcGxldGVUcmlnZ2VyLmNsb3NlUGFuZWwoKTtcbiAgICB9XG5cbiAgICB0aGlzLl9rZXl3b3JkJFxuICAgICAgLnBpcGUoXG4gICAgICAgIGRlYm91bmNlVGltZSgxNTApLFxuICAgICAgICBmaWx0ZXIoKGV2ZW50OiBLZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgICAgICAgcmV0dXJuICFldmVudCB8fCB0aGlzLl9pZ25vcmVLZXlzLmluZGV4T2YoZXZlbnQua2V5KSA9PT0gLTE7XG4gICAgICAgIH0pLFxuICAgICAgICBzd2l0Y2hNYXAoKGV2ZW50OiBhbnkpID0+IHtcbiAgICAgICAgICB0aGlzLmRhdGEgPSBbXTtcbiAgICAgICAgICB0aGlzLnNlYXJjaGluZyA9IHRydWU7XG4gICAgICAgICAgdGhpcy5fY2RSZWYubWFya0ZvckNoZWNrKCk7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZmV0Y2godHJpbShldmVudC50YXJnZXQudmFsdWUpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgIHRhcCgocmVzcG9uc2U6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IHJlc3BvbnNlO1xuICAgICAgICAgICAgICAgIHRoaXMubm9SZXN1bHRzID0gIXJlc3BvbnNlLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB0aGlzLl9jZFJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgICAgICAgICB0aGlzLmF1dG9jb21wbGV0ZS5vcGVuUGFuZWwoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKVxuICAgICAgICAgICk7XG4gICAgICAgIH0pLFxuICAgICAgICB0YWtlVW50aWwodGhpcy5fZGVzdHJveSQpLFxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIHRoaXMuX29uVG91Y2hlZCgpO1xuICAgICAgfSk7XG4gIH1cblxuICBwdWJsaWMgbG9hZCgpIHtcbiAgICB0aGlzLnNlYXJjaGluZyA9IHRydWU7XG4gICAgdGhpcy5fa2V5d29yZCQubmV4dCh7IHRhcmdldDogeyB2YWx1ZTogdGhpcy5fZ2V0S2V5d29yZCgpIH0gfSk7XG4gIH1cblxuICBwdWJsaWMgZm9jdXMoKSB7XG4gICAgdGhpcy5rZXl3b3JkSW5wdXQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICB9XG5cbiAgcHVibGljIGlucHV0Rm9jdXMoZTogS2V5Ym9hcmRFdmVudCkge1xuXG4gICAgaWYgKHRoaXMucmVhZG9ubHkgfHwgdGhpcy5kaXNhYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmZldGNoT25Gb2N1cykge1xuICAgICAgaWYgKCF0aGlzLm1vZGVsKSB7XG4gICAgICAgIHRoaXMubG9hZCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBpbnB1dEJsdXIoKSB7XG4gICAgaWYgKHRoaXMucmVhZG9ubHkgfHwgdGhpcy5kaXNhYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKCF0aGlzLm1vZGVsKSB7XG4gICAgICAgIHRoaXMuY2xlYXJLZXl3b3JkKCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX3VwZGF0ZUtleXdvcmREaXNwbGF5KCk7XG4gICAgICB0aGlzLmNsZWFyUmVzdWx0cygpO1xuICAgIH0sIDIwMCk7XG4gIH1cblxuICBwdWJsaWMgZGlzcGxheSA9IChkYXRhKSA9PiB7XG4gICAgaWYgKGRhdGEgJiYgdGhpcy5kaXNwbGF5V2l0aCkge1xuICAgICAgcmV0dXJuIHRoaXMuZGlzcGxheVdpdGgoZGF0YSk7XG4gICAgfVxuICAgIHJldHVybiAnJztcbiAgfVxuXG4gIHB1YmxpYyBzZWxlY3QodmFsdWUpIHtcbiAgICBpZiAoaXNPYmplY3QodmFsdWUpICYmIHZhbHVlLnN0YXRpY09wdGlvbkluZGV4ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuc3RhdGljU2VsZWN0KHZhbHVlLnN0YXRpY09wdGlvbkluZGV4KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5tb2RlbCA9IHZhbHVlO1xuICAgICAgdGhpcy5kYXRhID0gW107XG4gICAgICB0aGlzLl91cGRhdGVLZXl3b3JkRGlzcGxheSgpO1xuICAgICAgdGhpcy5fb25DaGFuZ2UodmFsdWUpO1xuICAgIH1cblxuICAgIHRoaXMuY2xlYXJSZXN1bHRzKCk7XG4gIH1cblxuICBwdWJsaWMgb3B0aW9uU2VsZWN0ZWQoZXZlbnQ6IE1hdEF1dG9jb21wbGV0ZVNlbGVjdGVkRXZlbnQpIHtcbiAgICB0aGlzLnNlbGVjdChldmVudC5vcHRpb24udmFsdWUpO1xuICAgIHRoaXMuYXV0b2NvbXBsZXRlLmNsb3NlUGFuZWwoKTtcbiAgfVxuXG4gIHB1YmxpYyBjbG9zZSgpIHtcbiAgICB0aGlzLmF1dG9jb21wbGV0ZS5jbG9zZVBhbmVsKCk7XG4gIH1cblxuICBwdWJsaWMgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KTogdm9pZCB7XG4gICAgdGhpcy5tb2RlbCA9IHZhbHVlO1xuICAgIHRoaXMuX3VwZGF0ZUtleXdvcmREaXNwbGF5KCk7XG4gIH1cblxuICBwdWJsaWMgc2V0RGlzYWJsZWRTdGF0ZShpc0Rpc2FibGVkOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XG4gIH1cblxuICBwdWJsaWMgaW5wdXQoZXZlbnQpIHtcblxuICAgIGlmICh0aGlzLnJlYWRvbmx5IHx8IHRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIWV2ZW50LnRhcmdldC52YWx1ZS5sZW5ndGgpIHtcbiAgICAgIHJldHVybiB0aGlzLmNsZWFyKCk7XG4gICAgfVxuXG4gICAgdGhpcy5fa2V5d29yZCQubmV4dChldmVudCk7XG4gIH1cblxuICBwdWJsaWMga2V5RG93bihldmVudDogS2V5Ym9hcmRFdmVudCkge1xuXG4gICAgaWYgKHRoaXMucmVhZG9ubHkgfHwgdGhpcy5kaXNhYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChldmVudC5jb2RlID09PSAnVGFiJykge1xuICAgICAgaWYgKCF0aGlzLm1vZGVsICYmIHRoaXMuYXV0b2NvbXBsZXRlLmFjdGl2ZU9wdGlvbikge1xuICAgICAgICB0aGlzLmtleXdvcmQgPSAnZHVtbXknOyAgICAgIFxuICAgICAgICB0aGlzLnNlbGVjdCh0aGlzLmF1dG9jb21wbGV0ZS5hY3RpdmVPcHRpb24udmFsdWUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZXZlbnQuY29kZSA9PT0gJ0JhY2tzcGFjZScpIHtcbiAgICAgIGlmICh0aGlzLm1vZGVsKSB7XG4gICAgICAgIHRoaXMubW9kZWwgPSBudWxsO1xuICAgICAgICB0aGlzLmNsZWFyS2V5d29yZCgpO1xuICAgICAgfVxuXG4gICAgfSBlbHNlIGlmICghdGhpcy5faXNXaW5kb3dzKCkgJiYgIXRoaXMuX2lzTWFjT1MoKSkge1xuXG4gICAgICBpZiAodGhpcy5faWdub3JlS2V5cy5pbmRleE9mKGV2ZW50LmtleSkgPT09IC0xKSB7XG4gICAgICAgIHRoaXMuc2VhcmNoaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5kYXRhID0gW107XG4gICAgICAgIGlmICh0aGlzLm1vZGVsKSB7XG4gICAgICAgICAgdGhpcy5jbGVhcigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGtleVVwKGV2ZW50OiBhbnkpIHtcbiAgICBpZiAodGhpcy5yZWFkb25seSB8fCB0aGlzLmRpc2FibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGV2ZW50LmNvZGUgPT09ICdCYWNrc3BhY2UnICYmICFldmVudC50YXJnZXQudmFsdWUubGVuZ3RoKSB7XG4gICAgICB0aGlzLmNsZWFyKCk7XG4gICAgICB0aGlzLmxvYWQoKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc3RhdGljU2VsZWN0KGluZGV4KSB7XG4gICAgaWYoIXRoaXMubW9kZWwpIHtcbiAgICAgIHRoaXMua2V5d29yZE5nTW9kZWwucmVzZXQoKTtcbiAgICB9XG5cbiAgICBjb25zdCBzdGF0aWNEaXJlY3RpdmU6IEZzQXV0b2NvbXBsZXRlU3RhdGljRGlyZWN0aXZlID0gdGhpcy5zdGF0aWNEaXJlY3RpdmVzLnRvQXJyYXkoKVtpbmRleF07XG4gICAgc3RhdGljRGlyZWN0aXZlLnNlbGVjdGVkLmVtaXQoKTtcbiAgfVxuXG4gIHB1YmxpYyBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLl9kZXN0cm95JC5uZXh0KCk7XG4gICAgdGhpcy5fZGVzdHJveSQuY29tcGxldGUoKTtcbiAgfVxuXG4gIHB1YmxpYyBjbGVhclJlc3VsdHMoY2xvc2VQYW5lbCA9IHRydWUpIHtcbiAgICB0aGlzLmRhdGEgPSBbXTtcbiAgICB0aGlzLm5vUmVzdWx0cyA9IGZhbHNlO1xuICAgIFxuICAgIGlmIChjbG9zZVBhbmVsKSB7XG4gICAgICB0aGlzLmF1dG9jb21wbGV0ZS5jbG9zZVBhbmVsKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGNsZWFyKGNsb3NlUGFuZWwgPSB0cnVlKSB7XG4gICAgdGhpcy5tb2RlbCA9IG51bGw7XG4gICAgdGhpcy5jbGVhclJlc3VsdHMoY2xvc2VQYW5lbCk7ICAgIFxuICAgIHRoaXMuY2xlYXJLZXl3b3JkKCk7XG4gICAgdGhpcy5fb25DaGFuZ2UobnVsbCk7XG4gIH1cblxuICBwdWJsaWMgY2xlYXJLZXl3b3JkKCkge1xuICAgIHRoaXMua2V5d29yZCA9IG51bGw7XG4gICAgdGhpcy5fdXBkYXRlS2V5d29yZERpc3BsYXkoKTtcbiAgfVxuXG4gIHB1YmxpYyBjbGVhckNsaWNrKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5jbGVhcihmYWxzZSk7XG4gICAgdGhpcy5rZXl3b3JkSW5wdXQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgIHRoaXMuY2xlYXJlZC5lbWl0KCk7XG4gIH1cblxuICBwcml2YXRlIF91cGRhdGVLZXl3b3JkRGlzcGxheSgpIHtcbiAgICBjb25zdCB2YWx1ZSA9IHRoaXMubW9kZWwgPyB0aGlzLmRpc3BsYXkodGhpcy5tb2RlbCkgOiAnJztcbiAgICB0aGlzLmtleXdvcmQgPSB0aGlzLm1vZGVsO1xuICAgIHRoaXMua2V5d29yZElucHV0Lm5hdGl2ZUVsZW1lbnQudmFsdWUgPSB2YWx1ZTtcbiAgICB0aGlzLl9jZFJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgfVxuXG4gIHByaXZhdGUgX2dldEtleXdvcmQoKSB7XG4gICAgcmV0dXJuIHRoaXMua2V5d29yZElucHV0Lm5hdGl2ZUVsZW1lbnQudmFsdWU7XG4gIH1cblxuICBwcml2YXRlIF9pc01hY09TKCkge1xuICAgIHJldHVybiBuYXZpZ2F0b3IucGxhdGZvcm0uaW5kZXhPZignTWFjJykgPiAtMTtcbiAgfVxuXG4gIHByaXZhdGUgX2lzV2luZG93cygpIHtcbiAgICByZXR1cm4gbmF2aWdhdG9yLnBsYXRmb3JtLmluZGV4T2YoJ1dpbicpID4gLTE7XG4gIH1cblxufVxuIiwiPG1hdC1mb3JtLWZpZWxkPlxuICA8bWF0LWxhYmVsIFthdHRyLmRhdGEtYWZ0ZXItY29udGVudF09XCJwbGFjZWhvbGRlclwiPjwvbWF0LWxhYmVsPlxuICA8aW5wdXRcbiAgICAja2V5d29yZElucHV0XG4gICAgI2tleXdvcmROZ01vZGVsPVwibmdNb2RlbFwiXG4gICAgbWF0SW5wdXRcbiAgICB0eXBlPVwic2VhcmNoXCJcbiAgICBbKG5nTW9kZWwpXT1cImtleXdvcmRcIlxuICAgIFtuYW1lXT1cIm5hbWVcIlxuICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiXG4gICAgW3JlYWRvbmx5XT1cInJlYWRvbmx5XCJcbiAgICBbcmVxdWlyZWRdPVwicmVxdWlyZWRcIlxuICAgIChmb2N1cyk9XCJpbnB1dEZvY3VzKCRldmVudClcIlxuICAgIChibHVyKT1cImlucHV0Qmx1cigpXCJcbiAgICAoaW5wdXQpPVwiaW5wdXQoJGV2ZW50KVwiXG4gICAgKGtleWRvd24pPVwia2V5RG93bigkZXZlbnQpXCJcbiAgICAoa2V5dXApPVwia2V5VXAoJGV2ZW50KVwiXG4gICAgW21hdEF1dG9jb21wbGV0ZV09XCJ1c2VyQXV0b2NvbXBsZXRlSW5wdXRcIj5cblxuICA8ZGl2ICpuZ0lmPVwiIWRpc2FibGVkXCIgbWF0U3VmZml4PlxuICAgIDxuZy1jb250YWluZXJcbiAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0XT1cInN1ZmZpeFwiXG4gICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwieyBkYXRhOiBtb2RlbCB9XCI+XG4gICAgPC9uZy1jb250YWluZXI+XG5cbiAgICA8bWF0LWljb25cbiAgICAgICpuZ0lmPVwic2hvd0NsZWFyICYmIG1vZGVsXCJcbiAgICAgIGNsYXNzPVwiY2xlYXJcIlxuICAgICAgKGNsaWNrKT1cImNsZWFyQ2xpY2soJGV2ZW50KVwiPmNsZWFyPC9tYXQtaWNvbj5cbiAgPC9kaXY+XG5cbiAgPG1hdC1hdXRvY29tcGxldGVcbiAgICAjdXNlckF1dG9jb21wbGV0ZUlucHV0PVwibWF0QXV0b2NvbXBsZXRlXCJcbiAgICBbYXV0b0FjdGl2ZUZpcnN0T3B0aW9uXT1cInRydWVcIlxuICAgIFtwYW5lbFdpZHRoXT1cInBhbmVsV2lkdGhcIlxuICAgIFtjbGFzc109XCJwYW5lbENsYXNzZXMuam9pbignICcpXCJcbiAgICBbZGlzcGxheVdpdGhdPVwiZGlzcGxheVwiXG4gICAgKG9wdGlvblNlbGVjdGVkKT1cIm9wdGlvblNlbGVjdGVkKCRldmVudClcIj5cblxuICAgIDxtYXQtb3B0aW9uICpuZ0Zvcj1cImxldCBpdGVtIG9mIGRhdGFcIiBbdmFsdWVdPVwiaXRlbVwiPlxuICAgICAgPG5nLWNvbnRhaW5lclxuICAgICAgICBbbmdUZW1wbGF0ZU91dGxldF09XCJ0ZW1wbGF0ZVwiXG4gICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0Q29udGV4dF09XCJ7IGRhdGE6IGl0ZW0gfVwiPlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgPC9tYXQtb3B0aW9uPlxuXG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIiFzZWFyY2hpbmdcIj5cbiAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJub1Jlc3VsdHNcIj5cbiAgICAgICAgPG5nLXRlbXBsYXRlXG4gICAgICAgICAgKm5nSWY9XCJub1Jlc3VsdHNUZW1wbGF0ZTsgZWxzZSBub1Jlc3VsdHNPcHRpb25cIlxuICAgICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0XT1cIm5vUmVzdWx0c1RlbXBsYXRlXCJcbiAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwieyAkaW1wbGljaXQ6IGtleXdvcmQgfVwiPlxuICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgICA8bmctdGVtcGxhdGUgI25vUmVzdWx0c09wdGlvbj5cbiAgICAgICAgICA8bWF0LW9wdGlvbiBkaXNhYmxlZCBjbGFzcz1cIm5vLXJlc3VsdHNcIj5cbiAgICAgICAgICAgIE5vIHJlc3VsdHMgPG5nLWNvbnRhaW5lciAqbmdJZj1cImtleXdvcmRcIj5mb3IgXCJ7e2tleXdvcmR9fVwiPC9uZy1jb250YWluZXI+XG4gICAgICAgICAgPC9tYXQtb3B0aW9uPlxuICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgPC9uZy1jb250YWluZXI+XG5cbiAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhbW9kZWwgJiYgKCFzZWFyY2hpbmcgfHwga2V5d29yZCkgJiYgc3RhdGljVGVtcGxhdGVzPy5sZW5ndGhcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInN0YXRpYy10ZW1wbGF0ZXNcIj5cbiAgICAgICAgICA8bmctY29udGFpbmVyICpuZ0Zvcj1cImxldCBzdGF0aWNUZW1wbGF0ZSBvZiBzdGF0aWNUZW1wbGF0ZXM7IGxldCBpID0gaW5kZXhcIj5cbiAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhc3RhdGljVGVtcGxhdGUuc2hvd1doZW5LZXl3b3JkIHx8ICEha2V5d29yZFwiPlxuICAgICAgICAgICAgICA8bWF0LW9wdGlvblxuICAgICAgICAgICAgICAgIGNsYXNzPVwic3RhdGljLW9wdGlvblwiXG4gICAgICAgICAgICAgICAgW3ZhbHVlXT1cInsgc3RhdGljT3B0aW9uSW5kZXg6IGkgfVwiXG4gICAgICAgICAgICAgICAgW25nQ2xhc3NdPVwieyAnc3RhdGljLW9wdGlvbi1maXJzdCc6ICFpIH1cIj5cbiAgICAgICAgICAgICAgICA8bmctdGVtcGxhdGVcbiAgICAgICAgICAgICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0XT1cInN0YXRpY1RlbXBsYXRlLnRlbXBsYXRlUmVmXCJcbiAgICAgICAgICAgICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0Q29udGV4dF09XCJ7ICRpbXBsaWNpdDoga2V5d29yZCB9XCJcbiAgICAgICAgICAgICAgICA+PC9uZy10ZW1wbGF0ZT5cbiAgICAgICAgICAgICAgPC9tYXQtb3B0aW9uPlxuICAgICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgPC9uZy1jb250YWluZXI+XG4gIDwvbWF0LWF1dG9jb21wbGV0ZT5cblxuICA8bWF0LWhpbnQgKm5nSWY9XCJoaW50XCI+e3sgaGludCB9fTwvbWF0LWhpbnQ+XG4gIDxtYXQtaGludCAqbmdJZj1cImhpbnRUZW1wbGF0ZVwiPlxuICAgIDxuZy1jb250YWluZXJcbiAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImhpbnRUZW1wbGF0ZVwiPlxuICAgIDwvbmctY29udGFpbmVyPlxuICA8L21hdC1oaW50PlxuPC9tYXQtZm9ybS1maWVsZD5cbiJdfQ==