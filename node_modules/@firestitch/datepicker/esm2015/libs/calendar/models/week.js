import { addWeeks, addYears, differenceInCalendarWeeks, differenceInCalendarYears, differenceInYears, isBefore, isSameWeek } from 'date-fns';
export class Week {
    constructor(_dateStart, _seedDate, _periodWeeks) {
        this._dateStart = _dateStart;
        this._seedDate = _seedDate;
        this._periodWeeks = _periodWeeks;
        this.days = [];
        this.firstWeekInPeriod = false;
        this.lastWeekInPeriod = false;
        this._periodVisible = false;
        if (this._seedDate && this._periodWeeks) {
            this.periodId = this._getPeriodId();
        }
        this._dateEnd = addWeeks(this._dateStart, 1);
    }
    get dateStart() {
        return this._dateStart;
    }
    get dateEnd() {
        return this._dateEnd;
    }
    get periodLableVisible() {
        return this._periodVisible;
    }
    /**
     * Add related day
     * @param day
     */
    addDay(day) {
        this.days.push(day);
    }
    /**
     * Add related period
     * @param period
     */
    addPeriod(period) {
        this.period = period;
    }
    /**
     * Set visibility for period label
     * @param flag
     */
    setPeriodVisibility(flag) {
        this._periodVisible = flag;
    }
    /**
     * To be able to draw borders for week
     */
    markAsFirstVisiblePeriodWeek() {
        this.firstWeekInPeriod = true;
    }
    markAsLastVisiblePeriodWeek() {
        this.lastWeekInPeriod = true;
    }
    /**
     * Calculate period ID based on week date start and seed date
     */
    _getPeriodId() {
        /**
         * If week date start before seed date
         */
        if (isBefore(this._dateStart, this._seedDate)) {
            const diffInYears = differenceInYears(this._dateStart, this._seedDate);
            const diffInCalendarYears = differenceInCalendarYears(this._dateStart, this._seedDate);
            const seedDate = new Date(this._seedDate);
            /**
             * Check if week date start includes seed date
             */
            const sameWeek = isSameWeek(this._dateStart, addYears(seedDate, diffInYears), { weekStartsOn: this._seedDate.getDay() });
            if (sameWeek) {
                seedDate.setFullYear(seedDate.getFullYear() + (diffInYears || -1));
            }
            else {
                seedDate.setFullYear(seedDate.getFullYear() + (diffInCalendarYears || -1));
            }
            const weeksDiff = differenceInCalendarWeeks(this._dateStart, seedDate, { weekStartsOn: this._seedDate.getDay() }) / this._periodWeeks;
            // Sometimes weeksDiff can be integer and we use +0.1 for easy round
            return Math.ceil(weeksDiff + 0.1);
        }
        else {
            const diffInYears = differenceInYears(addWeeks(this._dateStart, 1), this._seedDate);
            const seedDate = new Date(this._seedDate);
            seedDate.setFullYear(seedDate.getFullYear() + diffInYears);
            const weeksDiff = differenceInCalendarWeeks(this._dateStart, seedDate, { weekStartsOn: this._seedDate.getDay() }) / this._periodWeeks;
            // Sometimes weeksDiff can be integer and we use +0.1 for easy round
            return Math.ceil(weeksDiff + 0.1);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2Vlay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWJzL2NhbGVuZGFyL21vZGVscy93ZWVrLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxRQUFRLEVBQ1IsUUFBUSxFQUNSLHlCQUF5QixFQUN6Qix5QkFBeUIsRUFDekIsaUJBQWlCLEVBQ2pCLFFBQVEsRUFDUixVQUFVLEVBQ1gsTUFBTSxVQUFVLENBQUM7QUFNbEIsTUFBTSxPQUFPLElBQUk7SUFZZixZQUNVLFVBQWdCLEVBQ2hCLFNBQWUsRUFDZixZQUFvQjtRQUZwQixlQUFVLEdBQVYsVUFBVSxDQUFNO1FBQ2hCLGNBQVMsR0FBVCxTQUFTLENBQU07UUFDZixpQkFBWSxHQUFaLFlBQVksQ0FBUTtRQWJ2QixTQUFJLEdBQWMsRUFBRSxDQUFDO1FBSXJCLHNCQUFpQixHQUFHLEtBQUssQ0FBQztRQUMxQixxQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFFeEIsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFRN0IsSUFBSSxJQUFJLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDdkMsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7U0FDckM7UUFFRCxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFFRCxJQUFXLFNBQVM7UUFDbEIsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO0lBQ3pCLENBQUM7SUFFRCxJQUFXLE9BQU87UUFDaEIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxJQUFXLGtCQUFrQjtRQUMzQixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7SUFDN0IsQ0FBQztJQUVEOzs7T0FHRztJQUNJLE1BQU0sQ0FBQyxHQUFZO1FBQ3hCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3RCLENBQUM7SUFFRDs7O09BR0c7SUFDSSxTQUFTLENBQUMsTUFBYztRQUM3QixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksbUJBQW1CLENBQUMsSUFBYTtRQUN0QyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztJQUM3QixDQUFDO0lBRUQ7O09BRUc7SUFDSSw0QkFBNEI7UUFDakMsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQztJQUNoQyxDQUFDO0lBRU0sMkJBQTJCO1FBQ2hDLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUM7SUFDL0IsQ0FBQztJQUVEOztPQUVHO0lBQ0ssWUFBWTtRQUNsQjs7V0FFRztRQUNILElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFO1lBQzdDLE1BQU0sV0FBVyxHQUFHLGlCQUFpQixDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3ZFLE1BQU0sbUJBQW1CLEdBQUcseUJBQXlCLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFdkYsTUFBTSxRQUFRLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRTFDOztlQUVHO1lBQ0gsTUFBTSxRQUFRLEdBQUcsVUFBVSxDQUN6QixJQUFJLENBQUMsVUFBVSxFQUNmLFFBQVEsQ0FBQyxRQUFRLEVBQUUsV0FBVyxDQUFDLEVBQy9CLEVBQUUsWUFBWSxFQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLEVBQUMsQ0FDOUMsQ0FBQztZQUVGLElBQUksUUFBUSxFQUFFO2dCQUNaLFFBQVEsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxHQUFHLENBQUMsV0FBVyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUNwRTtpQkFBTTtnQkFDTCxRQUFRLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsR0FBRyxDQUFDLG1CQUFtQixJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUM1RTtZQUVELE1BQU0sU0FBUyxHQUFHLHlCQUF5QixDQUN6QyxJQUFJLENBQUMsVUFBVSxFQUNmLFFBQVEsRUFDUixFQUFFLFlBQVksRUFBTyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxFQUFDLENBQzVDLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQztZQUV4QixvRUFBb0U7WUFDcEUsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUMsQ0FBQztTQUNuQzthQUFNO1lBQ0wsTUFBTSxXQUFXLEdBQUcsaUJBQWlCLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRXBGLE1BQU0sUUFBUSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUMxQyxRQUFRLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsR0FBRyxXQUFXLENBQUMsQ0FBQztZQUUzRCxNQUFNLFNBQVMsR0FBRyx5QkFBeUIsQ0FDekMsSUFBSSxDQUFDLFVBQVUsRUFDZixRQUFRLEVBQ1IsRUFBRSxZQUFZLEVBQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsRUFBQyxDQUM1QyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUM7WUFFeEIsb0VBQW9FO1lBQ3BFLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDLENBQUM7U0FDbkM7SUFDSCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBhZGRXZWVrcyxcbiAgYWRkWWVhcnMsXG4gIGRpZmZlcmVuY2VJbkNhbGVuZGFyV2Vla3MsXG4gIGRpZmZlcmVuY2VJbkNhbGVuZGFyWWVhcnMsIGRpZmZlcmVuY2VJbldlZWtzLFxuICBkaWZmZXJlbmNlSW5ZZWFycyxcbiAgaXNCZWZvcmUsXG4gIGlzU2FtZVdlZWtcbn0gZnJvbSAnZGF0ZS1mbnMnO1xuXG5pbXBvcnQgeyBQZXJpb2QgfSBmcm9tICcuL3BlcmlvZCc7XG5pbXBvcnQgeyBEYXlJdGVtIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9kYXktaXRlbS5pbnRlcmZhY2UnO1xuXG5cbmV4cG9ydCBjbGFzcyBXZWVrIHtcblxuICBwdWJsaWMgZGF5czogRGF5SXRlbVtdID0gW107XG4gIHB1YmxpYyBwZXJpb2Q6IFBlcmlvZDtcbiAgcHVibGljIHBlcmlvZElkOiBudW1iZXI7XG5cbiAgcHVibGljIGZpcnN0V2Vla0luUGVyaW9kID0gZmFsc2U7XG4gIHB1YmxpYyBsYXN0V2Vla0luUGVyaW9kID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSBfcGVyaW9kVmlzaWJsZSA9IGZhbHNlO1xuICBwcml2YXRlIF9kYXRlRW5kOiBEYXRlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgX2RhdGVTdGFydDogRGF0ZSxcbiAgICBwcml2YXRlIF9zZWVkRGF0ZTogRGF0ZSxcbiAgICBwcml2YXRlIF9wZXJpb2RXZWVrczogbnVtYmVyXG4gICkge1xuICAgIGlmICh0aGlzLl9zZWVkRGF0ZSAmJiB0aGlzLl9wZXJpb2RXZWVrcykge1xuICAgICAgdGhpcy5wZXJpb2RJZCA9IHRoaXMuX2dldFBlcmlvZElkKCk7XG4gICAgfVxuXG4gICAgdGhpcy5fZGF0ZUVuZCA9IGFkZFdlZWtzKHRoaXMuX2RhdGVTdGFydCwgMSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGRhdGVTdGFydCgpIHtcbiAgICByZXR1cm4gdGhpcy5fZGF0ZVN0YXJ0O1xuICB9XG5cbiAgcHVibGljIGdldCBkYXRlRW5kKCkge1xuICAgIHJldHVybiB0aGlzLl9kYXRlRW5kO1xuICB9XG5cbiAgcHVibGljIGdldCBwZXJpb2RMYWJsZVZpc2libGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3BlcmlvZFZpc2libGU7XG4gIH1cblxuICAvKipcbiAgICogQWRkIHJlbGF0ZWQgZGF5XG4gICAqIEBwYXJhbSBkYXlcbiAgICovXG4gIHB1YmxpYyBhZGREYXkoZGF5OiBEYXlJdGVtKSB7XG4gICAgdGhpcy5kYXlzLnB1c2goZGF5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgcmVsYXRlZCBwZXJpb2RcbiAgICogQHBhcmFtIHBlcmlvZFxuICAgKi9cbiAgcHVibGljIGFkZFBlcmlvZChwZXJpb2Q6IFBlcmlvZCkge1xuICAgIHRoaXMucGVyaW9kID0gcGVyaW9kO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB2aXNpYmlsaXR5IGZvciBwZXJpb2QgbGFiZWxcbiAgICogQHBhcmFtIGZsYWdcbiAgICovXG4gIHB1YmxpYyBzZXRQZXJpb2RWaXNpYmlsaXR5KGZsYWc6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9wZXJpb2RWaXNpYmxlID0gZmxhZztcbiAgfVxuXG4gIC8qKlxuICAgKiBUbyBiZSBhYmxlIHRvIGRyYXcgYm9yZGVycyBmb3Igd2Vla1xuICAgKi9cbiAgcHVibGljIG1hcmtBc0ZpcnN0VmlzaWJsZVBlcmlvZFdlZWsoKSB7XG4gICAgdGhpcy5maXJzdFdlZWtJblBlcmlvZCA9IHRydWU7XG4gIH1cblxuICBwdWJsaWMgbWFya0FzTGFzdFZpc2libGVQZXJpb2RXZWVrKCkge1xuICAgIHRoaXMubGFzdFdlZWtJblBlcmlvZCA9IHRydWU7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHBlcmlvZCBJRCBiYXNlZCBvbiB3ZWVrIGRhdGUgc3RhcnQgYW5kIHNlZWQgZGF0ZVxuICAgKi9cbiAgcHJpdmF0ZSBfZ2V0UGVyaW9kSWQoKSB7XG4gICAgLyoqXG4gICAgICogSWYgd2VlayBkYXRlIHN0YXJ0IGJlZm9yZSBzZWVkIGRhdGVcbiAgICAgKi9cbiAgICBpZiAoaXNCZWZvcmUodGhpcy5fZGF0ZVN0YXJ0LCB0aGlzLl9zZWVkRGF0ZSkpIHtcbiAgICAgIGNvbnN0IGRpZmZJblllYXJzID0gZGlmZmVyZW5jZUluWWVhcnModGhpcy5fZGF0ZVN0YXJ0LCB0aGlzLl9zZWVkRGF0ZSk7XG4gICAgICBjb25zdCBkaWZmSW5DYWxlbmRhclllYXJzID0gZGlmZmVyZW5jZUluQ2FsZW5kYXJZZWFycyh0aGlzLl9kYXRlU3RhcnQsIHRoaXMuX3NlZWREYXRlKTtcblxuICAgICAgY29uc3Qgc2VlZERhdGUgPSBuZXcgRGF0ZSh0aGlzLl9zZWVkRGF0ZSk7XG5cbiAgICAgIC8qKlxuICAgICAgICogQ2hlY2sgaWYgd2VlayBkYXRlIHN0YXJ0IGluY2x1ZGVzIHNlZWQgZGF0ZVxuICAgICAgICovXG4gICAgICBjb25zdCBzYW1lV2VlayA9IGlzU2FtZVdlZWsoXG4gICAgICAgIHRoaXMuX2RhdGVTdGFydCxcbiAgICAgICAgYWRkWWVhcnMoc2VlZERhdGUsIGRpZmZJblllYXJzKSxcbiAgICAgICAgeyB3ZWVrU3RhcnRzT246IDxhbnk+dGhpcy5fc2VlZERhdGUuZ2V0RGF5KCl9XG4gICAgICApO1xuXG4gICAgICBpZiAoc2FtZVdlZWspIHtcbiAgICAgICAgc2VlZERhdGUuc2V0RnVsbFllYXIoc2VlZERhdGUuZ2V0RnVsbFllYXIoKSArIChkaWZmSW5ZZWFycyB8fCAtMSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2VlZERhdGUuc2V0RnVsbFllYXIoc2VlZERhdGUuZ2V0RnVsbFllYXIoKSArIChkaWZmSW5DYWxlbmRhclllYXJzIHx8IC0xKSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHdlZWtzRGlmZiA9IGRpZmZlcmVuY2VJbkNhbGVuZGFyV2Vla3MoXG4gICAgICAgIHRoaXMuX2RhdGVTdGFydCxcbiAgICAgICAgc2VlZERhdGUsXG4gICAgICAgIHsgd2Vla1N0YXJ0c09uOiA8YW55PnRoaXMuX3NlZWREYXRlLmdldERheSgpfVxuICAgICAgICApIC8gdGhpcy5fcGVyaW9kV2Vla3M7XG5cbiAgICAgIC8vIFNvbWV0aW1lcyB3ZWVrc0RpZmYgY2FuIGJlIGludGVnZXIgYW5kIHdlIHVzZSArMC4xIGZvciBlYXN5IHJvdW5kXG4gICAgICByZXR1cm4gTWF0aC5jZWlsKHdlZWtzRGlmZiArIDAuMSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGRpZmZJblllYXJzID0gZGlmZmVyZW5jZUluWWVhcnMoYWRkV2Vla3ModGhpcy5fZGF0ZVN0YXJ0LCAxKSwgdGhpcy5fc2VlZERhdGUpO1xuXG4gICAgICBjb25zdCBzZWVkRGF0ZSA9IG5ldyBEYXRlKHRoaXMuX3NlZWREYXRlKTtcbiAgICAgIHNlZWREYXRlLnNldEZ1bGxZZWFyKHNlZWREYXRlLmdldEZ1bGxZZWFyKCkgKyBkaWZmSW5ZZWFycyk7XG5cbiAgICAgIGNvbnN0IHdlZWtzRGlmZiA9IGRpZmZlcmVuY2VJbkNhbGVuZGFyV2Vla3MoXG4gICAgICAgIHRoaXMuX2RhdGVTdGFydCxcbiAgICAgICAgc2VlZERhdGUsXG4gICAgICAgIHsgd2Vla1N0YXJ0c09uOiA8YW55PnRoaXMuX3NlZWREYXRlLmdldERheSgpfVxuICAgICAgICApIC8gdGhpcy5fcGVyaW9kV2Vla3M7XG5cbiAgICAgIC8vIFNvbWV0aW1lcyB3ZWVrc0RpZmYgY2FuIGJlIGludGVnZXIgYW5kIHdlIHVzZSArMC4xIGZvciBlYXN5IHJvdW5kXG4gICAgICByZXR1cm4gTWF0aC5jZWlsKHdlZWtzRGlmZiArIDAuMSk7XG4gICAgfVxuICB9XG59XG4iXX0=