import { ChangeDetectionStrategy, Component, ElementRef, EventEmitter, Input, IterableDiffers, Output } from '@angular/core';
import { getStartDayDate } from '../../../common/helpers/get-start-day-date';
import { splitDateByComponents } from '../../../common/helpers/split-date-by-components';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
export class FsDatePickerTimeComponent {
    constructor(element, _iterableDiffers) {
        this.element = element;
        this._iterableDiffers = _iterableDiffers;
        this.date = null;
        this.disabledMinutes = [];
        this.disabledHours = [];
        this.disabledTimes = [];
        this.expanded = false;
        this.minutes = true;
        this.showNotSelected = true;
        this.onChange = new EventEmitter();
        this.selected = {};
        this.disabledTimeMinutes = {};
        this.disabledTimeHours = {};
        this.disabledGroupedMinutes = {};
        this.timeHoursCollapsed = [
            [
                [0, 1, 2, 3],
                [4, 5, 6, 7],
                [8, 9, 10, 11]
            ],
            [
                [12, 13, 14, 15],
                [16, 17, 18, 19],
                [20, 21, 22, 23]
            ]
        ];
        this.timeMinutesCollapsed = [
            [0, 5],
            [10, 15],
            [20, 25],
            [30, 35],
            [40, 45],
            [50, 55]
        ];
        this.timeHoursExpanded = [
            [0, 12],
            [1, 13],
            [2, 14],
            [3, 15],
            [4, 16],
            [5, 17],
            [6, 18],
            [7, 19],
            [8, 20],
            [9, 21],
            [10, 22],
            [11, 23]
        ];
        this.timeMinutesExpanded = [
            [0, 1, 2, 3, 4],
            [5, 6, 7, 8, 9],
            [10, 11, 12, 13, 14],
            [15, 16, 17, 18, 19],
            [20, 21, 22, 23, 24],
            [25, 26, 27, 28, 29],
            [30, 31, 32, 33, 34],
            [35, 36, 37, 38, 39],
            [40, 41, 42, 43, 44],
            [45, 46, 47, 48, 49],
            [50, 51, 52, 53, 54],
            [55, 56, 57, 58, 59]
        ];
        this.disabledMinutesDiffer = null;
        this.disabledHoursDiffer = null;
        this.disabledTimesDiffer = null;
        this.disabledHoursDiffer = this._iterableDiffers.find([]).create(null);
        this.disabledMinutesDiffer = this._iterableDiffers.find([]).create(null);
        this.disabledTimesDiffer = this._iterableDiffers.find([]).create(null);
    }
    ngOnInit() {
        this.checkDisabledTime();
        this.nowHour = (new Date()).getHours();
        this.nowMinute = this.minutes
            ? (new Date()).getMinutes()
            : 0;
    }
    ngOnChanges(changes) {
        if (changes && changes.date) {
            this.selected = splitDateByComponents(this.date);
            if (!this.minutes) {
                this.selected.minute = 0;
                if (this.date) {
                    this.date.setMinutes(0);
                }
            }
        }
    }
    ngDoCheck() {
        if (this.disabledHoursDiffer.diff(this.disabledHours) ||
            this.disabledMinutesDiffer.diff(this.disabledMinutes) ||
            this.disabledTimesDiffer.diff(this.disabledTimes)) {
            this.checkDisabledTime();
        }
    }
    checkDisabledTime() {
        this.disabledTimeMinutes = {};
        this.disabledTimeHours = {};
        this.disabledGroupedMinutes = {};
        if (this.disabledMinutes !== undefined) {
            for (const range of this.disabledMinutes) {
                this.addDisabledMinutes(range);
            }
        }
        if (this.disabledHours !== undefined) {
            for (const range of this.disabledHours) {
                this.addDisabledHours(range);
            }
        }
        if (this.disabledTimes !== undefined) {
            for (const range of this.disabledTimes) {
                const min = Math.min(range[0], range[1]);
                const max = Math.max(range[0], range[1]);
                const minMinutes = min % 60;
                const maxMinutes = max % 60;
                const minHour = Math.floor(min / 60);
                const maxHour = Math.floor(max / 60);
                for (let h = 0; h <= 24; h++) {
                    this.disabledGroupedMinutes[h] = {};
                    if (h > minHour && h < maxHour) {
                        this.addDisabledHours(h);
                    }
                    else if (h == minHour && !minMinutes && minHour != maxHour) {
                        this.addDisabledHours(h);
                    }
                    if (h >= minHour && h <= maxHour) {
                        for (let m = minMinutes; m < maxMinutes; m++) {
                            const minute = h * m;
                            if (minute >= range[0] && minute <= range[1]) {
                                this.disabledGroupedMinutes[h][m] = true;
                            }
                        }
                    }
                }
            }
        }
    }
    addDisabledMinutes(range) {
        const min = Math.min(range[0], range[1]);
        const max = Math.max(range[0], range[1]);
        if (Array.isArray(range)) {
            for (let i = min; i <= max; i++) {
                this.disabledTimeMinutes[i] = true;
            }
        }
        else {
            this.disabledTimeMinutes[range] = true;
        }
    }
    addDisabledHours(range) {
        const min = Math.min(range[0], range[1]);
        const max = Math.max(range[0], range[1]);
        if (Array.isArray(range)) {
            for (let i = min; i <= max; i++) {
                this.disabledTimeHours[i] = true;
            }
        }
        else {
            this.disabledTimeHours[range] = true;
        }
    }
    createModel() {
        if (!this.date) {
            this.setDate(getStartDayDate());
        }
    }
    setDate(date) {
        this.date = date;
        this.onChange.emit(date);
    }
    hourClick(hour) {
        if (this.disabledTimeHours[hour]) {
            return;
        }
        let newDate;
        if (!this.date) {
            newDate = getStartDayDate();
        }
        else {
            newDate = new Date(this.date);
        }
        newDate.setHours(hour);
        this.setDate(newDate);
    }
    minuteClick(minute) {
        if (this.disabledTimeMinutes[minute]
            || (this.disabledGroupedMinutes[this.selected.hour] && this.disabledGroupedMinutes[this.selected.hour][minute])) {
            return;
        }
        let newDate;
        if (!this.date) {
            newDate = getStartDayDate();
        }
        else {
            newDate = new Date(this.date);
        }
        newDate.setMinutes(minute);
        this.setDate(newDate);
    }
}
FsDatePickerTimeComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsDatePickerTimeComponent, deps: [{ token: i0.ElementRef }, { token: i0.IterableDiffers }], target: i0.ɵɵFactoryTarget.Component });
FsDatePickerTimeComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: FsDatePickerTimeComponent, selector: "fs-date-picker-time", inputs: { date: "date", disabledMinutes: "disabledMinutes", disabledHours: "disabledHours", disabledTimes: "disabledTimes", expanded: "expanded", minutes: "minutes", showNotSelected: "showNotSelected" }, outputs: { onChange: "onChange" }, usesOnChanges: true, ngImport: i0, template: "<div class=\"month-year time\" *ngIf=\"minutes && showNotSelected\">\n  <ng-container *ngIf=\"date; else noTime\">\n    {{ date | date:'h:mm aa'}}\n  </ng-container>\n  <ng-template #noTime>\n    Time Not Selected\n  </ng-template>\n</div>\n\n<div class=\"time-container\">\n  <table *ngIf=\"expanded; else contracted\">\n    <thead *ngIf=\"minutes\">\n      <tr>\n        <th class=\"hours-col\">\n          Hour\n        </th>\n        <th class=\"minutes-col\">\n          Minute\n        </th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr>\n        <td class=\"hours-col\">\n          <div class=\"hours-container\">\n            <table>\n              <tr *ngFor=\"let hours of timeHoursExpanded\">\n                <td\n                  *ngFor=\"let hour of hours\"\n                  class=\"tile number hour\"\n                  (click)=\"hourClick(hour)\"\n                  [ngClass]=\"{\n                    disabled: disabledTimeHours[hour],\n                    now: nowHour === hour,\n                    selected: hour == selected.hour\n                  }\">\n                  <div class=\"tile-content\">\n                    <span *ngIf=\"hour < 12\">{{ hour ? hour : 12 }}<span class=\"am-pm\">am</span></span>\n                    <span *ngIf=\"hour >= 12\">{{ hour==12 ? 12 : hour-12 }}<span class=\"am-pm\">pm</span></span>\n                  </div>\n                </td>\n              </tr>\n            </table>\n          </div>\n        </td>\n        <td class=\"minutes-col\" *ngIf=\"minutes\">\n          <div class=\"minutes-container\">\n            <table>\n              <tr *ngFor=\"let minutes of timeMinutesExpanded\">\n                <td *ngFor=\"let minute of minutes\"\n                    class=\"tile number minute\"\n                    [ngClass]=\"{\n                      disabled: disabledTimeMinutes[minute] || (disabledGroupedMinutes[selected.hour] && disabledGroupedMinutes[selected.hour][minute]),\n                      selected: minute == selected.minute,\n                      now: nowMinute === minute\n                    }\"\n                    (click)=\"minuteClick(minute)\">\n                    <div class=\"tile-content\">{{ minute }}</div>\n                </td>\n              </tr>\n            </table>\n          </div>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n</div>\n\n<ng-template #contracted>\n  <table>\n    <thead *ngIf=\"minutes\">\n      <tr>\n        <th class=\"hours-col\">\n          Hour\n        </th>\n        <th class=\"minutes-col\">\n          Minute\n        </th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr>\n        <td class=\"hours-col\">\n          <table>\n            <tbody *ngFor=\"let group of timeHoursCollapsed; let i = index\">\n            <tr *ngFor=\"let hours of group\">\n              <td\n                *ngFor=\"let hour of hours\"\n                class=\"tile number hour\"\n                (click)=\"hourClick(hour)\"\n                [ngClass]=\"{\n                  disabled: disabledTimeHours[hour],\n                  selected: hour == selected.hour,\n                  now: nowHour === hour\n                }\">\n                <div class=\"tile-content\">\n                  <span *ngIf=\"hour < 12\">{{ hour ? hour : 12 }}<span class=\"am-pm\">am</span></span>\n                  <span *ngIf=\"hour >= 12\">{{ hour==12 ? 12 : hour-12 }}<span class=\"am-pm\">pm</span></span>\n                </div>\n              </td>\n            </tr>\n            </tbody>\n          </table>\n        </td>\n\n        <td class=\"minutes-col\" *ngIf=\"minutes\">\n          <table>\n            <tr *ngFor=\"let minutes of timeMinutesCollapsed\">\n              <td\n                *ngFor=\"let minute of minutes\"\n                class=\"tile number minute\"\n                [ngClass]=\"{\n                  disabled: disabledTimeMinutes[minute] || (disabledGroupedMinutes[selected.hour] && disabledGroupedMinutes[selected.hour][minute]),\n                  selected: minute == selected.minute,\n                  now: nowMinute === minute\n                }\"\n                  (click)=\"minuteClick(minute)\">\n                <div class=\"tile-content\">{{ minute }}</div>\n              </td>\n            </tr>\n          </table>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n</ng-template>\n", styles: ["thead th{text-align:center}tbody .minutes-col,tbody .hours-col{padding:0}tbody .minutes-col{padding-left:20px}tbody .hours-container{margin-right:20px}tbody .minutes-container,tbody .hours-container{max-height:300px;overflow:auto}.time-container table{width:100%}.time-container table .am-pm{font-size:13px;padding-left:2px}\n"], directives: [{ type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }], pipes: { "date": i1.DatePipe }, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsDatePickerTimeComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'fs-date-picker-time',
                    templateUrl: './time.component.html',
                    styleUrls: ['./time.component.scss'],
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.IterableDiffers }]; }, propDecorators: { date: [{
                type: Input
            }], disabledMinutes: [{
                type: Input
            }], disabledHours: [{
                type: Input
            }], disabledTimes: [{
                type: Input
            }], expanded: [{
                type: Input
            }], minutes: [{
                type: Input
            }], showNotSelected: [{
                type: Input
            }], onChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGlicy9jYWxlbmRhci9jb21wb25lbnRzL3RpbWUvdGltZS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGlicy9jYWxlbmRhci9jb21wb25lbnRzL3RpbWUvdGltZS5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFFVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLEtBQUssRUFDTCxlQUFlLEVBR2YsTUFBTSxFQUNQLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw0Q0FBNEMsQ0FBQztBQUM3RSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxrREFBa0QsQ0FBQzs7O0FBU3pGLE1BQU0sT0FBTyx5QkFBeUI7SUEyRXBDLFlBQ1MsT0FBbUIsRUFDbEIsZ0JBQWlDO1FBRGxDLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFDbEIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFpQjtRQTNFM0IsU0FBSSxHQUFHLElBQUksQ0FBQztRQUNaLG9CQUFlLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLGtCQUFhLEdBQUcsRUFBRSxDQUFDO1FBQ25CLGtCQUFhLEdBQUcsRUFBRSxDQUFDO1FBQ25CLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsWUFBTyxHQUFHLElBQUksQ0FBQztRQUNmLG9CQUFlLEdBQUcsSUFBSSxDQUFDO1FBRXRCLGFBQVEsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBRTdDLGFBQVEsR0FBUSxFQUFFLENBQUM7UUFDbkIsd0JBQW1CLEdBQVEsRUFBRSxDQUFDO1FBQzlCLHNCQUFpQixHQUFRLEVBQUUsQ0FBQztRQUM1QiwyQkFBc0IsR0FBUSxFQUFFLENBQUM7UUFHakMsdUJBQWtCLEdBQUc7WUFDMUI7Z0JB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Q0FBQztTQUM3QjthQUFNO1lBQ0wsT0FBTyxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUMvQjtRQUVELE9BQU8sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFM0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN4QixDQUFDOzt1SEEvT1UseUJBQXlCOzJHQUF6Qix5QkFBeUIsK1RDdkJ0Qyxxd0lBOEhBOzRGRHZHYSx5QkFBeUI7a0JBTnJDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLHFCQUFxQjtvQkFDL0IsV0FBVyxFQUFFLHVCQUF1QjtvQkFDcEMsU0FBUyxFQUFFLENBQUMsdUJBQXVCLENBQUM7b0JBQ3BDLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO2lCQUNoRDsrSEFHaUIsSUFBSTtzQkFBbkIsS0FBSztnQkFDVSxlQUFlO3NCQUE5QixLQUFLO2dCQUNVLGFBQWE7c0JBQTVCLEtBQUs7Z0JBQ1UsYUFBYTtzQkFBNUIsS0FBSztnQkFDVSxRQUFRO3NCQUF2QixLQUFLO2dCQUNVLE9BQU87c0JBQXRCLEtBQUs7Z0JBQ1UsZUFBZTtzQkFBOUIsS0FBSztnQkFFVyxRQUFRO3NCQUF4QixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENvbXBvbmVudCxcbiAgRG9DaGVjayxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgSXRlcmFibGVEaWZmZXJzLFxuICBPbkNoYW5nZXMsXG4gIE9uSW5pdCxcbiAgT3V0cHV0XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBnZXRTdGFydERheURhdGUgfSBmcm9tICcuLi8uLi8uLi9jb21tb24vaGVscGVycy9nZXQtc3RhcnQtZGF5LWRhdGUnO1xuaW1wb3J0IHsgc3BsaXREYXRlQnlDb21wb25lbnRzIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMvc3BsaXQtZGF0ZS1ieS1jb21wb25lbnRzJztcblxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdmcy1kYXRlLXBpY2tlci10aW1lJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3RpbWUuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi90aW1lLmNvbXBvbmVudC5zY3NzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBGc0RhdGVQaWNrZXJUaW1lQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIERvQ2hlY2sge1xuXG4gIEBJbnB1dCgpIHB1YmxpYyBkYXRlID0gbnVsbDtcbiAgQElucHV0KCkgcHVibGljIGRpc2FibGVkTWludXRlcyA9IFtdO1xuICBASW5wdXQoKSBwdWJsaWMgZGlzYWJsZWRIb3VycyA9IFtdO1xuICBASW5wdXQoKSBwdWJsaWMgZGlzYWJsZWRUaW1lcyA9IFtdO1xuICBASW5wdXQoKSBwdWJsaWMgZXhwYW5kZWQgPSBmYWxzZTtcbiAgQElucHV0KCkgcHVibGljIG1pbnV0ZXMgPSB0cnVlO1xuICBASW5wdXQoKSBwdWJsaWMgc2hvd05vdFNlbGVjdGVkID0gdHJ1ZTtcblxuICBAT3V0cHV0KCkgcHVibGljIG9uQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgcHVibGljIHNlbGVjdGVkOiBhbnkgPSB7fTtcbiAgcHVibGljIGRpc2FibGVkVGltZU1pbnV0ZXM6IGFueSA9IHt9O1xuICBwdWJsaWMgZGlzYWJsZWRUaW1lSG91cnM6IGFueSA9IHt9O1xuICBwdWJsaWMgZGlzYWJsZWRHcm91cGVkTWludXRlczogYW55ID0ge307XG4gIHB1YmxpYyBub3dIb3VyO1xuICBwdWJsaWMgbm93TWludXRlO1xuICBwdWJsaWMgdGltZUhvdXJzQ29sbGFwc2VkID0gW1xuICAgIFtcbiAgICAgIFswLCAxLCAyLCAzXSxcbiAgICAgIFs0LCA1LCA2LCA3XSxcbiAgICAgIFs4LCA5LCAxMCwgMTFdXG4gICAgXSxcbiAgICBbXG4gICAgICBbMTIsIDEzLCAxNCwgMTVdLFxuICAgICAgWzE2LCAxNywgMTgsIDE5XSxcbiAgICAgIFsyMCwgMjEsIDIyLCAyM11cbiAgICBdXG4gIF07XG5cbiAgcHVibGljIHRpbWVNaW51dGVzQ29sbGFwc2VkID0gW1xuICAgIFswLCA1XSxcbiAgICBbMTAsIDE1XSxcbiAgICBbMjAsIDI1XSxcbiAgICBbMzAsIDM1XSxcbiAgICBbNDAsIDQ1XSxcbiAgICBbNTAsIDU1XVxuICBdO1xuXG4gIHB1YmxpYyB0aW1lSG91cnNFeHBhbmRlZCA9IFtcbiAgICBbMCwgMTJdLFxuICAgIFsxLCAxM10sXG4gICAgWzIsIDE0XSxcbiAgICBbMywgMTVdLFxuICAgIFs0LCAxNl0sXG4gICAgWzUsIDE3XSxcbiAgICBbNiwgMThdLFxuICAgIFs3LCAxOV0sXG4gICAgWzgsIDIwXSxcbiAgICBbOSwgMjFdLFxuICAgIFsxMCwgMjJdLFxuICAgIFsxMSwgMjNdXG4gIF07XG5cbiAgcHVibGljIHRpbWVNaW51dGVzRXhwYW5kZWQgPSBbXG4gICAgICAgICAgICAgIFswLCAxLCAyLCAzLCA0XSxcbiAgICAgICAgICAgICAgWzUsIDYsIDcsIDgsIDldLFxuICAgICAgICAgICAgICBbMTAsIDExLCAxMiwgMTMsIDE0XSxcbiAgICAgICAgICAgICAgWzE1LCAxNiwgMTcsIDE4LCAxOV0sXG4gICAgICAgICAgICAgIFsyMCwgMjEsIDIyLCAyMywgMjRdLFxuICAgICAgICAgICAgICBbMjUsIDI2LCAyNywgMjgsIDI5XSxcbiAgICAgICAgICAgICAgWzMwLCAzMSwgMzIsIDMzLCAzNF0sXG4gICAgICAgICAgICAgIFszNSwgMzYsIDM3LCAzOCwgMzldLFxuICAgICAgICAgICAgICBbNDAsIDQxLCA0MiwgNDMsIDQ0XSxcbiAgICAgICAgICAgICAgWzQ1LCA0NiwgNDcsIDQ4LCA0OV0sXG4gICAgICAgICAgICAgIFs1MCwgNTEsIDUyLCA1MywgNTRdLFxuICAgICAgICAgICAgICBbNTUsIDU2LCA1NywgNTgsIDU5XVxuICAgICAgICAgICAgXTtcblxuICBwcml2YXRlIGRpc2FibGVkTWludXRlc0RpZmZlciA9IG51bGw7XG4gIHByaXZhdGUgZGlzYWJsZWRIb3Vyc0RpZmZlciA9IG51bGw7XG4gIHByaXZhdGUgZGlzYWJsZWRUaW1lc0RpZmZlciA9IG51bGw7XG5cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgZWxlbWVudDogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIF9pdGVyYWJsZURpZmZlcnM6IEl0ZXJhYmxlRGlmZmVyc1xuICApIHtcbiAgICB0aGlzLmRpc2FibGVkSG91cnNEaWZmZXIgPSB0aGlzLl9pdGVyYWJsZURpZmZlcnMuZmluZChbXSkuY3JlYXRlKG51bGwpO1xuICAgIHRoaXMuZGlzYWJsZWRNaW51dGVzRGlmZmVyID0gdGhpcy5faXRlcmFibGVEaWZmZXJzLmZpbmQoW10pLmNyZWF0ZShudWxsKTtcbiAgICB0aGlzLmRpc2FibGVkVGltZXNEaWZmZXIgPSB0aGlzLl9pdGVyYWJsZURpZmZlcnMuZmluZChbXSkuY3JlYXRlKG51bGwpO1xuICB9XG5cbiAgcHVibGljIG5nT25Jbml0KCkge1xuICAgIHRoaXMuY2hlY2tEaXNhYmxlZFRpbWUoKTtcbiAgICB0aGlzLm5vd0hvdXIgPSAobmV3IERhdGUoKSkuZ2V0SG91cnMoKTtcbiAgICB0aGlzLm5vd01pbnV0ZSA9IHRoaXMubWludXRlc1xuICAgICAgPyAobmV3IERhdGUoKSkuZ2V0TWludXRlcygpXG4gICAgICA6IDA7XG4gIH1cblxuICBwdWJsaWMgbmdPbkNoYW5nZXMoY2hhbmdlcykge1xuICAgIGlmIChjaGFuZ2VzICYmIGNoYW5nZXMuZGF0ZSkge1xuICAgICAgdGhpcy5zZWxlY3RlZCA9IHNwbGl0RGF0ZUJ5Q29tcG9uZW50cyh0aGlzLmRhdGUpO1xuICAgICAgaWYgKCF0aGlzLm1pbnV0ZXMpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZC5taW51dGUgPSAwO1xuXG4gICAgICAgIGlmICh0aGlzLmRhdGUpIHtcbiAgICAgICAgICB0aGlzLmRhdGUuc2V0TWludXRlcygwKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBuZ0RvQ2hlY2soKSB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZWRIb3Vyc0RpZmZlci5kaWZmKHRoaXMuZGlzYWJsZWRIb3VycykgfHxcbiAgICB0aGlzLmRpc2FibGVkTWludXRlc0RpZmZlci5kaWZmKHRoaXMuZGlzYWJsZWRNaW51dGVzKSB8fFxuICAgIHRoaXMuZGlzYWJsZWRUaW1lc0RpZmZlci5kaWZmKHRoaXMuZGlzYWJsZWRUaW1lcylcbiAgICApIHtcbiAgICAgIHRoaXMuY2hlY2tEaXNhYmxlZFRpbWUoKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgY2hlY2tEaXNhYmxlZFRpbWUoKSB7XG5cbiAgICB0aGlzLmRpc2FibGVkVGltZU1pbnV0ZXMgPSB7fTtcbiAgICB0aGlzLmRpc2FibGVkVGltZUhvdXJzID0ge307XG4gICAgdGhpcy5kaXNhYmxlZEdyb3VwZWRNaW51dGVzID0ge307XG5cbiAgICBpZiAodGhpcy5kaXNhYmxlZE1pbnV0ZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZm9yIChjb25zdCByYW5nZSBvZiB0aGlzLmRpc2FibGVkTWludXRlcykge1xuICAgICAgICB0aGlzLmFkZERpc2FibGVkTWludXRlcyhyYW5nZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGlzYWJsZWRIb3VycyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBmb3IgKGNvbnN0IHJhbmdlIG9mIHRoaXMuZGlzYWJsZWRIb3Vycykge1xuICAgICAgICB0aGlzLmFkZERpc2FibGVkSG91cnMocmFuZ2UpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLmRpc2FibGVkVGltZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZm9yIChjb25zdCByYW5nZSBvZiB0aGlzLmRpc2FibGVkVGltZXMpIHtcblxuICAgICAgICBjb25zdCBtaW4gPSBNYXRoLm1pbihyYW5nZVswXSwgcmFuZ2VbMV0pO1xuICAgICAgICBjb25zdCBtYXggPSBNYXRoLm1heChyYW5nZVswXSwgcmFuZ2VbMV0pO1xuXG4gICAgICAgIGNvbnN0IG1pbk1pbnV0ZXMgPSBtaW4gJSA2MDtcbiAgICAgICAgY29uc3QgbWF4TWludXRlcyA9IG1heCAlIDYwO1xuXG4gICAgICAgIGNvbnN0IG1pbkhvdXIgPSBNYXRoLmZsb29yKG1pbiAvIDYwKTtcbiAgICAgICAgY29uc3QgbWF4SG91ciA9IE1hdGguZmxvb3IobWF4IC8gNjApO1xuXG4gICAgICAgIGZvciAobGV0IGggPSAwOyBoIDw9IDI0OyBoKyspIHtcblxuICAgICAgICAgIHRoaXMuZGlzYWJsZWRHcm91cGVkTWludXRlc1toXSA9IHt9O1xuXG4gICAgICAgICAgaWYgKGggPiBtaW5Ib3VyICYmIGggPCBtYXhIb3VyKSAge1xuICAgICAgICAgICAgdGhpcy5hZGREaXNhYmxlZEhvdXJzKGgpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoaCA9PSBtaW5Ib3VyICYmICFtaW5NaW51dGVzICYmIG1pbkhvdXIgIT0gbWF4SG91cikge1xuICAgICAgICAgICAgdGhpcy5hZGREaXNhYmxlZEhvdXJzKGgpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChoID49IG1pbkhvdXIgJiYgaCA8PSBtYXhIb3VyKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBtID0gbWluTWludXRlczsgbSA8IG1heE1pbnV0ZXM7IG0rKykge1xuICAgICAgICAgICAgICBjb25zdCBtaW51dGUgPSBoICogbTtcbiAgICAgICAgICAgICAgaWYgKG1pbnV0ZSA+PSByYW5nZVswXSAmJiBtaW51dGUgPD0gcmFuZ2VbMV0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGVkR3JvdXBlZE1pbnV0ZXNbaF1bbV0gPSB0cnVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGFkZERpc2FibGVkTWludXRlcyhyYW5nZSkge1xuICAgIGNvbnN0IG1pbiA9IE1hdGgubWluKHJhbmdlWzBdLCByYW5nZVsxXSk7XG4gICAgY29uc3QgbWF4ID0gTWF0aC5tYXgocmFuZ2VbMF0sIHJhbmdlWzFdKTtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShyYW5nZSkpIHtcbiAgICAgIGZvciAobGV0IGkgPSBtaW47IGkgPD0gbWF4OyBpKyspIHtcbiAgICAgICAgdGhpcy5kaXNhYmxlZFRpbWVNaW51dGVzW2ldID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kaXNhYmxlZFRpbWVNaW51dGVzW3JhbmdlXSA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGFkZERpc2FibGVkSG91cnMocmFuZ2UpIHtcbiAgICBjb25zdCBtaW4gPSBNYXRoLm1pbihyYW5nZVswXSwgcmFuZ2VbMV0pO1xuICAgIGNvbnN0IG1heCA9IE1hdGgubWF4KHJhbmdlWzBdLCByYW5nZVsxXSk7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkocmFuZ2UpKSB7XG4gICAgICBmb3IgKGxldCBpID0gbWluOyBpIDw9IG1heDsgaSsrKSB7XG4gICAgICAgIHRoaXMuZGlzYWJsZWRUaW1lSG91cnNbaV0gPSB0cnVlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRpc2FibGVkVGltZUhvdXJzW3JhbmdlXSA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGNyZWF0ZU1vZGVsKCkge1xuICAgIGlmICghdGhpcy5kYXRlKSB7XG4gICAgICB0aGlzLnNldERhdGUoZ2V0U3RhcnREYXlEYXRlKCkpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBzZXREYXRlKGRhdGUpIHtcbiAgICB0aGlzLmRhdGUgPSBkYXRlO1xuICAgIHRoaXMub25DaGFuZ2UuZW1pdChkYXRlKTtcbiAgfVxuXG4gIHB1YmxpYyBob3VyQ2xpY2soaG91cikge1xuXG4gICAgaWYgKHRoaXMuZGlzYWJsZWRUaW1lSG91cnNbaG91cl0pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgbmV3RGF0ZTogRGF0ZTtcblxuICAgIGlmICghdGhpcy5kYXRlKSB7XG4gICAgICBuZXdEYXRlID0gZ2V0U3RhcnREYXlEYXRlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5ld0RhdGUgPSBuZXcgRGF0ZSh0aGlzLmRhdGUpO1xuICAgIH1cblxuICAgIG5ld0RhdGUuc2V0SG91cnMoaG91cik7XG5cbiAgICB0aGlzLnNldERhdGUobmV3RGF0ZSk7XG4gIH1cblxuICBwdWJsaWMgbWludXRlQ2xpY2sobWludXRlKSB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZWRUaW1lTWludXRlc1ttaW51dGVdXG4gICAgICB8fCAodGhpcy5kaXNhYmxlZEdyb3VwZWRNaW51dGVzW3RoaXMuc2VsZWN0ZWQuaG91cl0gJiYgdGhpcy5kaXNhYmxlZEdyb3VwZWRNaW51dGVzW3RoaXMuc2VsZWN0ZWQuaG91cl1bbWludXRlXSlcbiAgICApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgbmV3RGF0ZTogRGF0ZTtcblxuICAgIGlmICghdGhpcy5kYXRlKSB7XG4gICAgICBuZXdEYXRlID0gZ2V0U3RhcnREYXlEYXRlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5ld0RhdGUgPSBuZXcgRGF0ZSh0aGlzLmRhdGUpO1xuICAgIH1cblxuICAgIG5ld0RhdGUuc2V0TWludXRlcyhtaW51dGUpO1xuXG4gICAgdGhpcy5zZXREYXRlKG5ld0RhdGUpO1xuICB9XG5cbn1cbiIsIjxkaXYgY2xhc3M9XCJtb250aC15ZWFyIHRpbWVcIiAqbmdJZj1cIm1pbnV0ZXMgJiYgc2hvd05vdFNlbGVjdGVkXCI+XG4gIDxuZy1jb250YWluZXIgKm5nSWY9XCJkYXRlOyBlbHNlIG5vVGltZVwiPlxuICAgIHt7IGRhdGUgfCBkYXRlOidoOm1tIGFhJ319XG4gIDwvbmctY29udGFpbmVyPlxuICA8bmctdGVtcGxhdGUgI25vVGltZT5cbiAgICBUaW1lIE5vdCBTZWxlY3RlZFxuICA8L25nLXRlbXBsYXRlPlxuPC9kaXY+XG5cbjxkaXYgY2xhc3M9XCJ0aW1lLWNvbnRhaW5lclwiPlxuICA8dGFibGUgKm5nSWY9XCJleHBhbmRlZDsgZWxzZSBjb250cmFjdGVkXCI+XG4gICAgPHRoZWFkICpuZ0lmPVwibWludXRlc1wiPlxuICAgICAgPHRyPlxuICAgICAgICA8dGggY2xhc3M9XCJob3Vycy1jb2xcIj5cbiAgICAgICAgICBIb3VyXG4gICAgICAgIDwvdGg+XG4gICAgICAgIDx0aCBjbGFzcz1cIm1pbnV0ZXMtY29sXCI+XG4gICAgICAgICAgTWludXRlXG4gICAgICAgIDwvdGg+XG4gICAgICA8L3RyPlxuICAgIDwvdGhlYWQ+XG4gICAgPHRib2R5PlxuICAgICAgPHRyPlxuICAgICAgICA8dGQgY2xhc3M9XCJob3Vycy1jb2xcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiaG91cnMtY29udGFpbmVyXCI+XG4gICAgICAgICAgICA8dGFibGU+XG4gICAgICAgICAgICAgIDx0ciAqbmdGb3I9XCJsZXQgaG91cnMgb2YgdGltZUhvdXJzRXhwYW5kZWRcIj5cbiAgICAgICAgICAgICAgICA8dGRcbiAgICAgICAgICAgICAgICAgICpuZ0Zvcj1cImxldCBob3VyIG9mIGhvdXJzXCJcbiAgICAgICAgICAgICAgICAgIGNsYXNzPVwidGlsZSBudW1iZXIgaG91clwiXG4gICAgICAgICAgICAgICAgICAoY2xpY2spPVwiaG91ckNsaWNrKGhvdXIpXCJcbiAgICAgICAgICAgICAgICAgIFtuZ0NsYXNzXT1cIntcbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ6IGRpc2FibGVkVGltZUhvdXJzW2hvdXJdLFxuICAgICAgICAgICAgICAgICAgICBub3c6IG5vd0hvdXIgPT09IGhvdXIsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBob3VyID09IHNlbGVjdGVkLmhvdXJcbiAgICAgICAgICAgICAgICAgIH1cIj5cbiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0aWxlLWNvbnRlbnRcIj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gKm5nSWY9XCJob3VyIDwgMTJcIj57eyBob3VyID8gaG91ciA6IDEyIH19PHNwYW4gY2xhc3M9XCJhbS1wbVwiPmFtPC9zcGFuPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gKm5nSWY9XCJob3VyID49IDEyXCI+e3sgaG91cj09MTIgPyAxMiA6IGhvdXItMTIgfX08c3BhbiBjbGFzcz1cImFtLXBtXCI+cG08L3NwYW4+PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICAgIDwvdGFibGU+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvdGQ+XG4gICAgICAgIDx0ZCBjbGFzcz1cIm1pbnV0ZXMtY29sXCIgKm5nSWY9XCJtaW51dGVzXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cIm1pbnV0ZXMtY29udGFpbmVyXCI+XG4gICAgICAgICAgICA8dGFibGU+XG4gICAgICAgICAgICAgIDx0ciAqbmdGb3I9XCJsZXQgbWludXRlcyBvZiB0aW1lTWludXRlc0V4cGFuZGVkXCI+XG4gICAgICAgICAgICAgICAgPHRkICpuZ0Zvcj1cImxldCBtaW51dGUgb2YgbWludXRlc1wiXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzPVwidGlsZSBudW1iZXIgbWludXRlXCJcbiAgICAgICAgICAgICAgICAgICAgW25nQ2xhc3NdPVwie1xuICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkOiBkaXNhYmxlZFRpbWVNaW51dGVzW21pbnV0ZV0gfHwgKGRpc2FibGVkR3JvdXBlZE1pbnV0ZXNbc2VsZWN0ZWQuaG91cl0gJiYgZGlzYWJsZWRHcm91cGVkTWludXRlc1tzZWxlY3RlZC5ob3VyXVttaW51dGVdKSxcbiAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogbWludXRlID09IHNlbGVjdGVkLm1pbnV0ZSxcbiAgICAgICAgICAgICAgICAgICAgICBub3c6IG5vd01pbnV0ZSA9PT0gbWludXRlXG4gICAgICAgICAgICAgICAgICAgIH1cIlxuICAgICAgICAgICAgICAgICAgICAoY2xpY2spPVwibWludXRlQ2xpY2sobWludXRlKVwiPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGlsZS1jb250ZW50XCI+e3sgbWludXRlIH19PC9kaXY+XG4gICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICAgIDwvdGFibGU+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvdGQ+XG4gICAgICA8L3RyPlxuICAgIDwvdGJvZHk+XG4gIDwvdGFibGU+XG48L2Rpdj5cblxuPG5nLXRlbXBsYXRlICNjb250cmFjdGVkPlxuICA8dGFibGU+XG4gICAgPHRoZWFkICpuZ0lmPVwibWludXRlc1wiPlxuICAgICAgPHRyPlxuICAgICAgICA8dGggY2xhc3M9XCJob3Vycy1jb2xcIj5cbiAgICAgICAgICBIb3VyXG4gICAgICAgIDwvdGg+XG4gICAgICAgIDx0aCBjbGFzcz1cIm1pbnV0ZXMtY29sXCI+XG4gICAgICAgICAgTWludXRlXG4gICAgICAgIDwvdGg+XG4gICAgICA8L3RyPlxuICAgIDwvdGhlYWQ+XG4gICAgPHRib2R5PlxuICAgICAgPHRyPlxuICAgICAgICA8dGQgY2xhc3M9XCJob3Vycy1jb2xcIj5cbiAgICAgICAgICA8dGFibGU+XG4gICAgICAgICAgICA8dGJvZHkgKm5nRm9yPVwibGV0IGdyb3VwIG9mIHRpbWVIb3Vyc0NvbGxhcHNlZDsgbGV0IGkgPSBpbmRleFwiPlxuICAgICAgICAgICAgPHRyICpuZ0Zvcj1cImxldCBob3VycyBvZiBncm91cFwiPlxuICAgICAgICAgICAgICA8dGRcbiAgICAgICAgICAgICAgICAqbmdGb3I9XCJsZXQgaG91ciBvZiBob3Vyc1wiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJ0aWxlIG51bWJlciBob3VyXCJcbiAgICAgICAgICAgICAgICAoY2xpY2spPVwiaG91ckNsaWNrKGhvdXIpXCJcbiAgICAgICAgICAgICAgICBbbmdDbGFzc109XCJ7XG4gICAgICAgICAgICAgICAgICBkaXNhYmxlZDogZGlzYWJsZWRUaW1lSG91cnNbaG91cl0sXG4gICAgICAgICAgICAgICAgICBzZWxlY3RlZDogaG91ciA9PSBzZWxlY3RlZC5ob3VyLFxuICAgICAgICAgICAgICAgICAgbm93OiBub3dIb3VyID09PSBob3VyXG4gICAgICAgICAgICAgICAgfVwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0aWxlLWNvbnRlbnRcIj5cbiAgICAgICAgICAgICAgICAgIDxzcGFuICpuZ0lmPVwiaG91ciA8IDEyXCI+e3sgaG91ciA/IGhvdXIgOiAxMiB9fTxzcGFuIGNsYXNzPVwiYW0tcG1cIj5hbTwvc3Bhbj48L3NwYW4+XG4gICAgICAgICAgICAgICAgICA8c3BhbiAqbmdJZj1cImhvdXIgPj0gMTJcIj57eyBob3VyPT0xMiA/IDEyIDogaG91ci0xMiB9fTxzcGFuIGNsYXNzPVwiYW0tcG1cIj5wbTwvc3Bhbj48L3NwYW4+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICAgPC90Ym9keT5cbiAgICAgICAgICA8L3RhYmxlPlxuICAgICAgICA8L3RkPlxuXG4gICAgICAgIDx0ZCBjbGFzcz1cIm1pbnV0ZXMtY29sXCIgKm5nSWY9XCJtaW51dGVzXCI+XG4gICAgICAgICAgPHRhYmxlPlxuICAgICAgICAgICAgPHRyICpuZ0Zvcj1cImxldCBtaW51dGVzIG9mIHRpbWVNaW51dGVzQ29sbGFwc2VkXCI+XG4gICAgICAgICAgICAgIDx0ZFxuICAgICAgICAgICAgICAgICpuZ0Zvcj1cImxldCBtaW51dGUgb2YgbWludXRlc1wiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJ0aWxlIG51bWJlciBtaW51dGVcIlxuICAgICAgICAgICAgICAgIFtuZ0NsYXNzXT1cIntcbiAgICAgICAgICAgICAgICAgIGRpc2FibGVkOiBkaXNhYmxlZFRpbWVNaW51dGVzW21pbnV0ZV0gfHwgKGRpc2FibGVkR3JvdXBlZE1pbnV0ZXNbc2VsZWN0ZWQuaG91cl0gJiYgZGlzYWJsZWRHcm91cGVkTWludXRlc1tzZWxlY3RlZC5ob3VyXVttaW51dGVdKSxcbiAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBtaW51dGUgPT0gc2VsZWN0ZWQubWludXRlLFxuICAgICAgICAgICAgICAgICAgbm93OiBub3dNaW51dGUgPT09IG1pbnV0ZVxuICAgICAgICAgICAgICAgIH1cIlxuICAgICAgICAgICAgICAgICAgKGNsaWNrKT1cIm1pbnV0ZUNsaWNrKG1pbnV0ZSlcIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGlsZS1jb250ZW50XCI+e3sgbWludXRlIH19PC9kaXY+XG4gICAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgICA8L3RyPlxuICAgICAgICAgIDwvdGFibGU+XG4gICAgICAgIDwvdGQ+XG4gICAgICA8L3RyPlxuICAgIDwvdGJvZHk+XG4gIDwvdGFibGU+XG48L25nLXRlbXBsYXRlPlxuIl19