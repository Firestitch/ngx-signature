import { ChangeDetectionStrategy, Component, Input } from '@angular/core';
import { map, shareReplay, } from 'rxjs/operators';
import { addMonths, isBefore } from 'date-fns';
import { FsDatePickerDialogModel } from '../../../../../dialog/classes/dialog-model';
import { FsDatePickerDialogRef } from '../../../../classes/dialog-ref';
import * as i0 from "@angular/core";
import * as i1 from "../header-month-range/header-month-range.component";
import * as i2 from "../../../../../calendar/components/calendar/calendar.component";
import * as i3 from "../../../../../calendar/components/time/time.component";
import * as i4 from "@angular/material/button";
import * as i5 from "@angular/common";
export class FsMonthRangePickerComponent {
    constructor() { }
    ngOnChanges(changes) {
        var _a, _b;
        if (((_a = changes.datePickerModel) === null || _a === void 0 ? void 0 : _a.currentValue)
            && ((_b = changes.datePickerModel) === null || _b === void 0 ? void 0 : _b.firstChange)
            && this.datePickerModel.view === 'monthrange') {
            this._initMonthRangeModels();
        }
    }
    viewModeChanged(mode) {
        this.datePickerModel.setCalendarMode(mode);
    }
    monthChanged(month) {
        this.datePickerModel.setCalendarMonth(month);
    }
    yearChanged(year) {
        this.datePickerModel.setCalendarYear(year);
    }
    nextMonth() {
        this.datePickerModel.nextMonth();
    }
    prevMonth() {
        this.datePickerModel.prevMonth();
    }
    dateChanged(date) {
        const rangeRef = this.datePickerModel.rangePickerRef;
        const { startDate, endDate } = rangeRef;
        if (!startDate && !endDate) {
            rangeRef.updateStartDate(date);
        }
        else if (startDate && !endDate) {
            if (isBefore(date, startDate)) {
                rangeRef.updateStartDate(date);
                rangeRef.updateEndDate(null);
            }
            else {
                rangeRef.updateEndDate(date);
            }
        }
        else if (startDate && endDate) {
            rangeRef.updateStartDate(date);
            rangeRef.updateEndDate(null);
        }
    }
    periodChanged(date) {
        this.datePickerModel.period = date;
        this.close();
    }
    setDateMode(mode) {
        this.datePickerModel.dateMode = mode;
    }
    close() {
        this.dialogRef.close();
    }
    _initMonthRangeModels() {
        this.leftCalendarDate$ = this.datePickerModel.calendarDate$;
        this.rightCalendarDate$ = this.datePickerModel.calendarDate$
            .pipe(map((value) => value && addMonths(value, 1) || null));
        this.modelFrom$ = this.datePickerModel
            .rangePickerRef
            .startDate$
            .pipe(shareReplay());
        this.modelTo$ = this.datePickerModel
            .rangePickerRef
            .endDate$
            .pipe(shareReplay());
    }
}
FsMonthRangePickerComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsMonthRangePickerComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });
FsMonthRangePickerComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: FsMonthRangePickerComponent, selector: "fs-datepicker-month-range-picker", inputs: { dialogRef: "dialogRef", datePickerModel: "datePickerModel" }, usesOnChanges: true, ngImport: i0, template: "<div class=\"calendar-container\">\n  <div class=\"date-time\">\n    <div class=\"calendar-view\">\n      <fs-date-picker-header-month-range\n        [calendarDate]=\"leftCalendarDate$ | async\"\n        [nextCalendarDate]=\"rightCalendarDate$ | async\"\n        (goNextMonth)=\"nextMonth()\"\n        (goPrevMonth)=\"prevMonth()\"\n      >\n      </fs-date-picker-header-month-range>\n\n      <div class=\"month-range-container\">\n        <fs-date-picker-calendar\n          [rangeFrom]=\"modelFrom$ | async\"\n          [rangeTo]=\"modelTo$ | async\"\n          [drawMonth]=\"leftCalendarDate$ | async\"\n          [dateMode]=\"datePickerModel.calendarMode$ | async\"\n          [highlightStartDate]=\"modelFrom$ | async\"\n          [highlightEndDate]=\"modelTo$ | async\"\n          [disabledDays]=\"datePickerModel.disabledDays$ | async\"\n          [hideExtraDays]=\"true\"\n          (change)=\"dateChanged($event)\">\n        </fs-date-picker-calendar>\n\n        <fs-date-picker-calendar\n          [rangeFrom]=\"modelFrom$ | async\"\n          [rangeTo]=\"modelTo$ | async\"\n          [highlightStartDate]=\"modelFrom$ | async\"\n          [highlightEndDate]=\"modelTo$ | async\"\n          [drawMonth]=\"rightCalendarDate$ | async\"\n          [dateMode]=\"datePickerModel.calendarMode$ | async\"\n          [disabledDays]=\"datePickerModel.disabledDays$ | async\"\n          [hideExtraDays]=\"true\"\n          (change)=\"dateChanged($event)\">\n        </fs-date-picker-calendar>\n      </div>\n    </div>\n\n    <ng-container\n      *ngIf=\"datePickerModel.dateMode !== 'year' && datePickerModel.dateMode !== 'month'\">\n      <fs-date-picker-time\n        *ngIf=\"datePickerModel.view === 'datetime' || datePickerModel.view === 'time'\"\n        [date]=\"datePickerModel.model$ | async\"\n        [minutes]=\"datePickerModel.minutes\"\n        [disabledTimes]=\"datePickerModel.disabledTimes$ | async\"\n        (onChange)=\"dateChanged($event)\"\n      ></fs-date-picker-time>\n    </ng-container>\n  </div>\n\n  <div class=\"buttons\">\n    <button class=\"button-done\" type=\"button\" mat-button color=\"primary\" (click)=\"close()\">Done</button>\n  </div>\n</div>\n", styles: [".month-range-container{display:grid;grid-template-columns:1fr 1fr;grid-column-gap:40px;align-items:start;min-height:265px}fs-date-picker-calendar{display:flex}\n"], components: [{ type: i1.FsDatePickerHeaderMonthRangeComponent, selector: "fs-date-picker-header-month-range", inputs: ["calendarDate", "nextCalendarDate"], outputs: ["goNextMonth", "goPrevMonth"] }, { type: i2.FsDatePickerCalendarComponent, selector: "fs-date-picker-calendar", inputs: ["date", "period", "rangeFrom", "rangeTo", "highlightStartDate", "highlightEndDate", "dateMode", "disabledDays", "drawMonth", "seedDate", "periodWeeks", "hideExtraDays"], outputs: ["change", "rangeChange", "periodChange", "hoverDay"] }, { type: i3.FsDatePickerTimeComponent, selector: "fs-date-picker-time", inputs: ["date", "disabledMinutes", "disabledHours", "disabledTimes", "expanded", "minutes", "showNotSelected"], outputs: ["onChange"] }, { type: i4.MatButton, selector: "button[mat-button], button[mat-raised-button], button[mat-icon-button],             button[mat-fab], button[mat-mini-fab], button[mat-stroked-button],             button[mat-flat-button]", inputs: ["disabled", "disableRipple", "color"], exportAs: ["matButton"] }], directives: [{ type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], pipes: { "async": i5.AsyncPipe }, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsMonthRangePickerComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'fs-datepicker-month-range-picker',
                    templateUrl: './month-range-picker.component.html',
                    styleUrls: ['./month-range-picker.component.scss'],
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return []; }, propDecorators: { dialogRef: [{
                type: Input
            }], datePickerModel: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9udGgtcmFuZ2UtcGlja2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWJzL2RpYWxvZy9tb2R1bGVzL2Rlc2t0b3AtZGlhbG9nLWNvbnRhaW5lci9jb21wb25lbnRzL21vbnRoLXJhbmdlLXBpY2tlci9tb250aC1yYW5nZS1waWNrZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2xpYnMvZGlhbG9nL21vZHVsZXMvZGVza3RvcC1kaWFsb2ctY29udGFpbmVyL2NvbXBvbmVudHMvbW9udGgtcmFuZ2UtcGlja2VyL21vbnRoLXJhbmdlLXBpY2tlci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBNEIsTUFBTSxlQUFlLENBQUM7QUFHcEcsT0FBTyxFQUNMLEdBQUcsRUFDSCxXQUFXLEdBQ1osTUFBTSxnQkFBZ0IsQ0FBQztBQUV4QixPQUFPLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUUvQyxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSw0Q0FBNEMsQ0FBQztBQUNyRixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQzs7Ozs7OztBQVN2RSxNQUFNLE9BQU8sMkJBQTJCO0lBY3RDLGdCQUFlLENBQUM7SUFFVCxXQUFXLENBQUMsT0FBc0I7O1FBQ3ZDLElBQ0UsQ0FBQSxNQUFBLE9BQU8sQ0FBQyxlQUFlLDBDQUFFLFlBQVk7Z0JBQ2xDLE1BQUEsT0FBTyxDQUFDLGVBQWUsMENBQUUsV0FBVyxDQUFBO2VBQ3BDLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxLQUFLLFlBQVksRUFDN0M7WUFDQSxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztTQUM5QjtJQUNILENBQUM7SUFFTSxlQUFl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QyxNQUFNO2lCQUNoRDswRUFJUSxTQUFTO3NCQURmLEtBQUs7Z0JBSUMsZUFBZTtzQkFEckIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQsIElucHV0LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtcbiAgbWFwLFxuICBzaGFyZVJlcGxheSxcbn0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBhZGRNb250aHMsIGlzQmVmb3JlIH0gZnJvbSAnZGF0ZS1mbnMnO1xuXG5pbXBvcnQgeyBGc0RhdGVQaWNrZXJEaWFsb2dNb2RlbCB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL2RpYWxvZy9jbGFzc2VzL2RpYWxvZy1tb2RlbCc7XG5pbXBvcnQgeyBGc0RhdGVQaWNrZXJEaWFsb2dSZWYgfSBmcm9tICcuLi8uLi8uLi8uLi9jbGFzc2VzL2RpYWxvZy1yZWYnO1xuXG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2ZzLWRhdGVwaWNrZXItbW9udGgtcmFuZ2UtcGlja2VyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL21vbnRoLXJhbmdlLXBpY2tlci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL21vbnRoLXJhbmdlLXBpY2tlci5jb21wb25lbnQuc2NzcyddLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgRnNNb250aFJhbmdlUGlja2VyQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcblxuICBASW5wdXQoKVxuICBwdWJsaWMgZGlhbG9nUmVmOiBGc0RhdGVQaWNrZXJEaWFsb2dSZWY7XG5cbiAgQElucHV0KClcbiAgcHVibGljIGRhdGVQaWNrZXJNb2RlbDogRnNEYXRlUGlja2VyRGlhbG9nTW9kZWw7XG5cbiAgcHVibGljIGxlZnRDYWxlbmRhckRhdGUkOiBPYnNlcnZhYmxlPERhdGU+O1xuICBwdWJsaWMgcmlnaHRDYWxlbmRhckRhdGUkOiBPYnNlcnZhYmxlPERhdGU+O1xuXG4gIHB1YmxpYyBtb2RlbEZyb20kOiBPYnNlcnZhYmxlPERhdGU+O1xuICBwdWJsaWMgbW9kZWxUbyQ6IE9ic2VydmFibGU8RGF0ZT47XG5cbiAgY29uc3RydWN0b3IoKSB7fVxuXG4gIHB1YmxpYyBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKFxuICAgICAgY2hhbmdlcy5kYXRlUGlja2VyTW9kZWw/LmN1cnJlbnRWYWx1ZVxuICAgICAgJiYgY2hhbmdlcy5kYXRlUGlja2VyTW9kZWw/LmZpcnN0Q2hhbmdlXG4gICAgICAmJiB0aGlzLmRhdGVQaWNrZXJNb2RlbC52aWV3ID09PSAnbW9udGhyYW5nZSdcbiAgICApIHtcbiAgICAgIHRoaXMuX2luaXRNb250aFJhbmdlTW9kZWxzKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHZpZXdNb2RlQ2hhbmdlZChtb2RlOiBzdHJpbmcpIHtcbiAgICB0aGlzLmRhdGVQaWNrZXJNb2RlbC5zZXRDYWxlbmRhck1vZGUobW9kZSk7XG4gIH1cblxuICBwdWJsaWMgbW9udGhDaGFuZ2VkKG1vbnRoOiBudW1iZXIpIHtcbiAgICB0aGlzLmRhdGVQaWNrZXJNb2RlbC5zZXRDYWxlbmRhck1vbnRoKG1vbnRoKTtcbiAgfVxuXG4gIHB1YmxpYyB5ZWFyQ2hhbmdlZCh5ZWFyOiBudW1iZXIpIHtcbiAgICB0aGlzLmRhdGVQaWNrZXJNb2RlbC5zZXRDYWxlbmRhclllYXIoeWVhcik7XG4gIH1cblxuICBwdWJsaWMgbmV4dE1vbnRoKCk6IHZvaWQge1xuICAgIHRoaXMuZGF0ZVBpY2tlck1vZGVsLm5leHRNb250aCgpO1xuICB9XG5cbiAgcHVibGljIHByZXZNb250aCgpOiB2b2lkIHtcbiAgICB0aGlzLmRhdGVQaWNrZXJNb2RlbC5wcmV2TW9udGgoKTtcbiAgfVxuXG4gIHB1YmxpYyBkYXRlQ2hhbmdlZChkYXRlKTogdm9pZCB7XG4gICAgY29uc3QgcmFuZ2VSZWYgPSB0aGlzLmRhdGVQaWNrZXJNb2RlbC5yYW5nZVBpY2tlclJlZjtcbiAgICBjb25zdCB7IHN0YXJ0RGF0ZSwgZW5kRGF0ZSB9ID0gcmFuZ2VSZWY7XG5cbiAgICBpZiAoIXN0YXJ0RGF0ZSAmJiAhZW5kRGF0ZSkge1xuICAgICAgcmFuZ2VSZWYudXBkYXRlU3RhcnREYXRlKGRhdGUpO1xuICAgIH0gZWxzZSBpZiAoc3RhcnREYXRlICYmICFlbmREYXRlKSB7XG4gICAgICBpZiAoaXNCZWZvcmUoZGF0ZSwgc3RhcnREYXRlKSkge1xuICAgICAgICByYW5nZVJlZi51cGRhdGVTdGFydERhdGUoZGF0ZSk7XG4gICAgICAgIHJhbmdlUmVmLnVwZGF0ZUVuZERhdGUobnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByYW5nZVJlZi51cGRhdGVFbmREYXRlKGRhdGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoc3RhcnREYXRlICYmIGVuZERhdGUpIHtcbiAgICAgIHJhbmdlUmVmLnVwZGF0ZVN0YXJ0RGF0ZShkYXRlKTtcbiAgICAgIHJhbmdlUmVmLnVwZGF0ZUVuZERhdGUobnVsbCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHBlcmlvZENoYW5nZWQoZGF0ZSk6IHZvaWQge1xuICAgIHRoaXMuZGF0ZVBpY2tlck1vZGVsLnBlcmlvZCA9IGRhdGU7XG5cbiAgICB0aGlzLmNsb3NlKCk7XG4gIH1cblxuICBwdWJsaWMgc2V0RGF0ZU1vZGUobW9kZSkge1xuICAgIHRoaXMuZGF0ZVBpY2tlck1vZGVsLmRhdGVNb2RlID0gbW9kZTtcbiAgfVxuXG4gIHB1YmxpYyBjbG9zZSgpOiB2b2lkIHtcbiAgICB0aGlzLmRpYWxvZ1JlZi5jbG9zZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBfaW5pdE1vbnRoUmFuZ2VNb2RlbHMoKTogdm9pZCB7XG4gICAgdGhpcy5sZWZ0Q2FsZW5kYXJEYXRlJCA9IHRoaXMuZGF0ZVBpY2tlck1vZGVsLmNhbGVuZGFyRGF0ZSQ7XG4gICAgdGhpcy5yaWdodENhbGVuZGFyRGF0ZSQgPSB0aGlzLmRhdGVQaWNrZXJNb2RlbC5jYWxlbmRhckRhdGUkXG4gICAgICAucGlwZShcbiAgICAgICAgbWFwKCh2YWx1ZSkgPT4gdmFsdWUgJiYgYWRkTW9udGhzKHZhbHVlLCAxKSB8fCBudWxsKSxcbiAgICAgICk7XG5cbiAgICB0aGlzLm1vZGVsRnJvbSQgPSB0aGlzLmRhdGVQaWNrZXJNb2RlbFxuICAgICAgLnJhbmdlUGlja2VyUmVmXG4gICAgICAuc3RhcnREYXRlJFxuICAgICAgLnBpcGUoXG4gICAgICAgIHNoYXJlUmVwbGF5KCksXG4gICAgICApO1xuXG4gICAgdGhpcy5tb2RlbFRvJCA9IHRoaXMuZGF0ZVBpY2tlck1vZGVsXG4gICAgICAucmFuZ2VQaWNrZXJSZWZcbiAgICAgIC5lbmREYXRlJFxuICAgICAgLnBpcGUoXG4gICAgICAgIHNoYXJlUmVwbGF5KCksXG4gICAgICApO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwiY2FsZW5kYXItY29udGFpbmVyXCI+XG4gIDxkaXYgY2xhc3M9XCJkYXRlLXRpbWVcIj5cbiAgICA8ZGl2IGNsYXNzPVwiY2FsZW5kYXItdmlld1wiPlxuICAgICAgPGZzLWRhdGUtcGlja2VyLWhlYWRlci1tb250aC1yYW5nZVxuICAgICAgICBbY2FsZW5kYXJEYXRlXT1cImxlZnRDYWxlbmRhckRhdGUkIHwgYXN5bmNcIlxuICAgICAgICBbbmV4dENhbGVuZGFyRGF0ZV09XCJyaWdodENhbGVuZGFyRGF0ZSQgfCBhc3luY1wiXG4gICAgICAgIChnb05leHRNb250aCk9XCJuZXh0TW9udGgoKVwiXG4gICAgICAgIChnb1ByZXZNb250aCk9XCJwcmV2TW9udGgoKVwiXG4gICAgICA+XG4gICAgICA8L2ZzLWRhdGUtcGlja2VyLWhlYWRlci1tb250aC1yYW5nZT5cblxuICAgICAgPGRpdiBjbGFzcz1cIm1vbnRoLXJhbmdlLWNvbnRhaW5lclwiPlxuICAgICAgICA8ZnMtZGF0ZS1waWNrZXItY2FsZW5kYXJcbiAgICAgICAgICBbcmFuZ2VGcm9tXT1cIm1vZGVsRnJvbSQgfCBhc3luY1wiXG4gICAgICAgICAgW3JhbmdlVG9dPVwibW9kZWxUbyQgfCBhc3luY1wiXG4gICAgICAgICAgW2RyYXdNb250aF09XCJsZWZ0Q2FsZW5kYXJEYXRlJCB8IGFzeW5jXCJcbiAgICAgICAgICBbZGF0ZU1vZGVdPVwiZGF0ZVBpY2tlck1vZGVsLmNhbGVuZGFyTW9kZSQgfCBhc3luY1wiXG4gICAgICAgICAgW2hpZ2hsaWdodFN0YXJ0RGF0ZV09XCJtb2RlbEZyb20kIHwgYXN5bmNcIlxuICAgICAgICAgIFtoaWdobGlnaHRFbmREYXRlXT1cIm1vZGVsVG8kIHwgYXN5bmNcIlxuICAgICAgICAgIFtkaXNhYmxlZERheXNdPVwiZGF0ZVBpY2tlck1vZGVsLmRpc2FibGVkRGF5cyQgfCBhc3luY1wiXG4gICAgICAgICAgW2hpZGVFeHRyYURheXNdPVwidHJ1ZVwiXG4gICAgICAgICAgKGNoYW5nZSk9XCJkYXRlQ2hhbmdlZCgkZXZlbnQpXCI+XG4gICAgICAgIDwvZnMtZGF0ZS1waWNrZXItY2FsZW5kYXI+XG5cbiAgICAgICAgPGZzLWRhdGUtcGlja2VyLWNhbGVuZGFyXG4gICAgICAgICAgW3JhbmdlRnJvbV09XCJtb2RlbEZyb20kIHwgYXN5bmNcIlxuICAgICAgICAgIFtyYW5nZVRvXT1cIm1vZGVsVG8kIHwgYXN5bmNcIlxuICAgICAgICAgIFtoaWdobGlnaHRTdGFydERhdGVdPVwibW9kZWxGcm9tJCB8IGFzeW5jXCJcbiAgICAgICAgICBbaGlnaGxpZ2h0RW5kRGF0ZV09XCJtb2RlbFRvJCB8IGFzeW5jXCJcbiAgICAgICAgICBbZHJhd01vbnRoXT1cInJpZ2h0Q2FsZW5kYXJEYXRlJCB8IGFzeW5jXCJcbiAgICAgICAgICBbZGF0ZU1vZGVdPVwiZGF0ZVBpY2tlck1vZGVsLmNhbGVuZGFyTW9kZSQgfCBhc3luY1wiXG4gICAgICAgICAgW2Rpc2FibGVkRGF5c109XCJkYXRlUGlja2VyTW9kZWwuZGlzYWJsZWREYXlzJCB8IGFzeW5jXCJcbiAgICAgICAgICBbaGlkZUV4dHJhRGF5c109XCJ0cnVlXCJcbiAgICAgICAgICAoY2hhbmdlKT1cImRhdGVDaGFuZ2VkKCRldmVudClcIj5cbiAgICAgICAgPC9mcy1kYXRlLXBpY2tlci1jYWxlbmRhcj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuXG4gICAgPG5nLWNvbnRhaW5lclxuICAgICAgKm5nSWY9XCJkYXRlUGlja2VyTW9kZWwuZGF0ZU1vZGUgIT09ICd5ZWFyJyAmJiBkYXRlUGlja2VyTW9kZWwuZGF0ZU1vZGUgIT09ICdtb250aCdcIj5cbiAgICAgIDxmcy1kYXRlLXBpY2tlci10aW1lXG4gICAgICAgICpuZ0lmPVwiZGF0ZVBpY2tlck1vZGVsLnZpZXcgPT09ICdkYXRldGltZScgfHwgZGF0ZVBpY2tlck1vZGVsLnZpZXcgPT09ICd0aW1lJ1wiXG4gICAgICAgIFtkYXRlXT1cImRhdGVQaWNrZXJNb2RlbC5tb2RlbCQgfCBhc3luY1wiXG4gICAgICAgIFttaW51dGVzXT1cImRhdGVQaWNrZXJNb2RlbC5taW51dGVzXCJcbiAgICAgICAgW2Rpc2FibGVkVGltZXNdPVwiZGF0ZVBpY2tlck1vZGVsLmRpc2FibGVkVGltZXMkIHwgYXN5bmNcIlxuICAgICAgICAob25DaGFuZ2UpPVwiZGF0ZUNoYW5nZWQoJGV2ZW50KVwiXG4gICAgICA+PC9mcy1kYXRlLXBpY2tlci10aW1lPlxuICAgIDwvbmctY29udGFpbmVyPlxuICA8L2Rpdj5cblxuICA8ZGl2IGNsYXNzPVwiYnV0dG9uc1wiPlxuICAgIDxidXR0b24gY2xhc3M9XCJidXR0b24tZG9uZVwiIHR5cGU9XCJidXR0b25cIiBtYXQtYnV0dG9uIGNvbG9yPVwicHJpbWFyeVwiIChjbGljayk9XCJjbG9zZSgpXCI+RG9uZTwvYnV0dG9uPlxuICA8L2Rpdj5cbjwvZGl2PlxuIl19