import { ChangeDetectionStrategy, Component, Input, Output, EventEmitter, ElementRef, } from '@angular/core';
import { endOfYear, startOfYear } from 'date-fns';
import { isRangeDisabled } from '../../../../../common/helpers/is-range-disabled';
import { MONTHS } from '../../../../../calendar/consts/months';
import { isMonthDisabled } from '../../../../../common/helpers/is-month-disabled';
import * as i0 from "@angular/core";
import * as i1 from "@angular/material/icon";
import * as i2 from "@angular/common";
import * as i3 from "@firestitch/date";
export class FsDatePickerHeaderComponent {
    constructor(_elRef) {
        this._elRef = _elRef;
        this.monthChange = new EventEmitter();
        this.yearChange = new EventEmitter();
        this.goNextMonth = new EventEmitter();
        this.goPrevMonth = new EventEmitter();
        this.viewModeChange = new EventEmitter();
        this.now = new Date();
        this.monthNow = this.now.getMonth();
        this.yearNow = this.now.getFullYear();
        this.yearsList = [];
        this.monthList = [];
    }
    get calendarMonth() {
        var _a;
        return (_a = this.calendarDate) === null || _a === void 0 ? void 0 : _a.getMonth();
    }
    get calendarYear() {
        var _a;
        return (_a = this.calendarDate) === null || _a === void 0 ? void 0 : _a.getFullYear();
    }
    get calendarDay() {
        var _a;
        return (_a = this.calendarDate) === null || _a === void 0 ? void 0 : _a.getDate();
    }
    ngOnChanges(changes) {
    }
    ngAfterViewInit() {
        this._createMonthsList();
        this._createYearsList();
    }
    selectMonth(month) {
        this.monthChange.emit(month);
        this.setViewMode('date');
    }
    selectYear(year) {
        this.yearChange.emit(year);
        this.setViewMode('date');
    }
    setViewMode(mode) {
        this.viewModeChange.emit(mode);
        this._scrollToSelectedYear();
        this._scrollToSelectedMonth();
    }
    nextMonth() {
        this.goNextMonth.emit();
    }
    prevMonth() {
        this.goPrevMonth.emit();
    }
    _createYearsList() {
        this.yearsList = [];
        for (let y = this.minYear; y < this.maxYear; y++) {
            const year = new Date().setFullYear(y);
            this.yearsList.push({ value: y, disabled: this._isYearDisabled(year) });
        }
    }
    _createMonthsList() {
        const year = this.calendarMonth ? this.calendarYear : this.now.getFullYear();
        const checkIfMonthDisabled = (monthNumber, disabledDays) => {
            const month = new Date();
            month.setFullYear(year);
            month.setMonth(monthNumber);
            return isMonthDisabled(month, disabledDays);
        };
        this.monthList = [];
        for (const item of MONTHS) {
            const monthItem = Object.assign(Object.assign({}, item), { disabled: checkIfMonthDisabled(item.value, this.disabledDays) });
            this.monthList.push(monthItem);
        }
    }
    _isYearDisabled(date) {
        const startYear = startOfYear(date);
        const endYear = endOfYear(date);
        return isRangeDisabled(this.disabledDays, startYear, endYear);
    }
    _scrollToSelectedYear() {
        setTimeout(() => {
            const years = this._elRef.nativeElement.querySelector('.years');
            const selected = years.querySelector('.year.selected');
            if (selected) {
                selected.scrollIntoView({ behavior: 'auto', block: 'center' });
            }
        });
    }
    _scrollToSelectedMonth() {
        setTimeout(() => {
            const years = this._elRef.nativeElement.querySelector('.months');
            const selected = years.querySelector('.month.selected');
            if (selected) {
                selected.scrollIntoView({ behavior: 'auto', block: 'center' });
            }
        });
    }
}
FsDatePickerHeaderComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsDatePickerHeaderComponent, deps: [{ token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component });
FsDatePickerHeaderComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: FsDatePickerHeaderComponent, selector: "fs-date-picker-header", inputs: { viewMode: "viewMode", minYear: "minYear", maxYear: "maxYear", disabledDays: "disabledDays", calendarDate: "calendarDate" }, outputs: { monthChange: "monthChange", yearChange: "yearChange", goNextMonth: "goNextMonth", goPrevMonth: "goPrevMonth", viewModeChange: "viewModeChange" }, usesOnChanges: true, ngImport: i0, template: "<div class=\"months-years\" *ngIf=\"viewMode == 'month' || viewMode == 'year'\">\n  <div class=\"months\">\n    <div\n      *ngFor=\"let month of monthList\"\n      (click)=\"selectMonth(month.value)\"\n      class=\"month\"\n      [ngClass]=\"{\n          now: monthNow == month.value,\n          selected: calendarMonth === month.value,\n          disabled: month.disabled\n        }\">\n      <div class=\"tile-content\">{{ month.abr }}</div>\n    </div>\n  </div>\n\n  <div class=\"years\">\n    <ng-container *ngFor=\"let year of yearsList;\">\n      <div\n        class=\"year data-year-{{ year.value }}\"\n        (click)=\"selectYear(year.value)\"\n        [class.now]=\"yearNow == year.value\"\n        [class.selected]=\"calendarYear === year.value\"\n        [class.disabled]=\"year.disabled\">\n        <div class=\"tile-content\">{{ year.value }}</div>\n      </div>\n    </ng-container>\n    <div class=\"clear\"></div>\n  </div>\n</div>\n\n<div *ngIf=\"viewMode == 'week' || viewMode == 'date' || viewMode == 'datetime' || viewMode == 'monthrange'\" class=\"calendar\">\n  <div class=\"month-year\">\n    <a class=\"month-year-name\" (click)=\"setViewMode('month')\">\n      {{ calendarDate | fsDateFormat: 'full-date-dayless-yearless' }}\n\n      <span *ngIf=\"calendarDay\" class=\"day-name\">\n        {{ calendarDay }},\n      </span>\n\n      {{ calendarYear }}\n      <mat-icon class=\"action\">arrow_drop_down</mat-icon>\n    </a>\n\n    <div class=\"gap\"></div>\n\n    <div class=\"action\">\n      <a (click)=\"prevMonth()\" class=\"action\">\n        <mat-icon>navigate_before</mat-icon>\n      </a>\n      <a (click)=\"nextMonth()\" class=\"action\">\n        <mat-icon>navigate_next</mat-icon>\n      </a>\n    </div>\n  </div>\n\n</div>\n", styles: [".months{width:350px}.month-year-name{color:inherit;border-radius:3px;display:flex;align-items:center;padding:5px 5px 5px 10px}.month-year-name:hover{background-color:#eaeaea;border-radius:3px}.day-name{padding:0 4px}.actions a{padding:6px;color:#757575}a.action{color:#757575}.months-years{display:flex;height:100%;min-width:350px}.months-years .years{overflow:auto;width:100%}.months-years .years .year{text-align:center;height:50px;line-height:50px;outline:none;cursor:pointer;box-sizing:border-box}.months-years .months{width:100%;height:100%;overflow:auto}.months-years .months .tile-content{width:50px;height:50px}.months-years .months .month{text-align:center;display:flex;justify-content:center;flex-direction:column;cursor:pointer;outline:none;border-bottom:0;border-right:0;box-sizing:border-box}\n"], components: [{ type: i1.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }], directives: [{ type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i2.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }], pipes: { "fsDateFormat": i3.FsDateFormatPipe }, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsDatePickerHeaderComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'fs-date-picker-header',
                    templateUrl: './header.component.html',
                    styleUrls: [
                        './header.component.scss',
                    ],
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }]; }, propDecorators: { viewMode: [{
                type: Input
            }], minYear: [{
                type: Input
            }], maxYear: [{
                type: Input
            }], disabledDays: [{
                type: Input
            }], calendarDate: [{
                type: Input
            }], monthChange: [{
                type: Output
            }], yearChange: [{
                type: Output
            }], goNextMonth: [{
                type: Output
            }], goPrevMonth: [{
                type: Output
            }], viewModeChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVhZGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWJzL2RpYWxvZy9tb2R1bGVzL2Rlc2t0b3AtZGlhbG9nLWNvbnRhaW5lci9jb21wb25lbnRzL2hlYWRlci9oZWFkZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2xpYnMvZGlhbG9nL21vZHVsZXMvZGVza3RvcC1kaWFsb2ctY29udGFpbmVyL2NvbXBvbmVudHMvaGVhZGVyL2hlYWRlci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxLQUFLLEVBSUwsTUFBTSxFQUNOLFlBQVksRUFDWixVQUFVLEdBQ1gsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFFbEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGlEQUFpRCxDQUFDO0FBQ2xGLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUMvRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0saURBQWlELENBQUM7Ozs7O0FBd0JsRixNQUFNLE9BQU8sMkJBQTJCO0lBdUN0QyxZQUNVLE1BQWtCO1FBQWxCLFdBQU0sR0FBTixNQUFNLENBQVk7UUF0QnJCLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUd6QyxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUd4QyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFRLENBQUM7UUFHdkMsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBR3ZDLG1CQUFjLEdBQUcsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUVuQyxRQUFHLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUNqQixhQUFRLEdB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QUUsTUFBTSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUMsQ0FBQyxDQUFDO2FBQzlEO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDOzt5SEFySlUsMkJBQTJCOzZHQUEzQiwyQkFBMkIscVhDeEN4Qyx5dURBd0RBOzRGRGhCYSwyQkFBMkI7a0JBUnZDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLHVCQUF1QjtvQkFDakMsV0FBVyxFQUFFLHlCQUF5QjtvQkFDdEMsU0FBUyxFQUFFO3dCQUNULHlCQUF5QjtxQkFDMUI7b0JBQ0QsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07aUJBQ2hEO2lHQUlRLFFBQVE7c0JBRGQsS0FBSztnQkFJQyxPQUFPO3NCQURiLEtBQUs7Z0JBSUMsT0FBTztzQkFEYixLQUFLO2dCQUlDLFlBQVk7c0JBRGxCLEtBQUs7Z0JBSUMsWUFBWTtzQkFEbEIsS0FBSztnQkFJQyxXQUFXO3NCQURqQixNQUFNO2dCQUlBLFVBQVU7c0JBRGhCLE1BQU07Z0JBSUEsV0FBVztzQkFEakIsTUFBTTtnQkFJQSxXQUFXO3NCQURqQixNQUFNO2dCQUlBLGNBQWM7c0JBRHBCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ29tcG9uZW50LFxuICBJbnB1dCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgT25DaGFuZ2VzLFxuICBTaW1wbGVDaGFuZ2VzLFxuICBPdXRwdXQsXG4gIEV2ZW50RW1pdHRlcixcbiAgRWxlbWVudFJlZixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IGVuZE9mWWVhciwgc3RhcnRPZlllYXIgfSBmcm9tICdkYXRlLWZucyc7XG5cbmltcG9ydCB7IGlzUmFuZ2VEaXNhYmxlZCB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL2NvbW1vbi9oZWxwZXJzL2lzLXJhbmdlLWRpc2FibGVkJztcbmltcG9ydCB7IE1PTlRIUyB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL2NhbGVuZGFyL2NvbnN0cy9tb250aHMnO1xuaW1wb3J0IHsgaXNNb250aERpc2FibGVkIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMvaXMtbW9udGgtZGlzYWJsZWQnO1xuXG5cbmludGVyZmFjZSBJWWVhckxpc3RJdGVtIHtcbiAgdmFsdWU6IG51bWJlcjtcbiAgZGlzYWJsZWQ6IGJvb2xlYW47XG59XG5cbmludGVyZmFjZSBJTW9udGhMaXN0SXRlbSB7XG4gIHZhbHVlOiBudW1iZXI7XG4gIG5hbWU6IHN0cmluZztcbiAgYWJyOiBzdHJpbmc7XG4gIGRpc2FibGVkOiBib29sZWFuO1xufVxuXG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2ZzLWRhdGUtcGlja2VyLWhlYWRlcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9oZWFkZXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFtcbiAgICAnLi9oZWFkZXIuY29tcG9uZW50LnNjc3MnLFxuICBdLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgRnNEYXRlUGlja2VySGVhZGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0IHtcblxuICBASW5wdXQoKVxuICBwdWJsaWMgdmlld01vZGU6IHN0cmluZztcblxuICBASW5wdXQoKVxuICBwdWJsaWMgbWluWWVhcjogbnVtYmVyO1xuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBtYXhZZWFyOiBudW1iZXI7XG5cbiAgQElucHV0KClcbiAgcHVibGljIGRpc2FibGVkRGF5czogW0RhdGUsIERhdGVdW107XG5cbiAgQElucHV0KClcbiAgcHVibGljIGNhbGVuZGFyRGF0ZTogRGF0ZTtcblxuICBAT3V0cHV0KClcbiAgcHVibGljIG1vbnRoQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXI+KCk7XG5cbiAgQE91dHB1dCgpXG4gIHB1YmxpYyB5ZWFyQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXI+KCk7XG5cbiAgQE91dHB1dCgpXG4gIHB1YmxpYyBnb05leHRNb250aCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICBAT3V0cHV0KClcbiAgcHVibGljIGdvUHJldk1vbnRoID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG4gIEBPdXRwdXQoKVxuICBwdWJsaWMgdmlld01vZGVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcblxuICBwdWJsaWMgcmVhZG9ubHkgbm93ID0gbmV3IERhdGUoKTtcbiAgcHVibGljIHJlYWRvbmx5IG1vbnRoTm93ID0gdGhpcy5ub3cuZ2V0TW9udGgoKTtcbiAgcHVibGljIHJlYWRvbmx5IHllYXJOb3cgPSB0aGlzLm5vdy5nZXRGdWxsWWVhcigpO1xuXG4gIHB1YmxpYyB5ZWFyc0xpc3Q6IElZZWFyTGlzdEl0ZW1bXSA9IFtdO1xuICBwdWJsaWMgbW9udGhMaXN0OiBJTW9udGhMaXN0SXRlbVtdID0gW107XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBfZWxSZWY6IEVsZW1lbnRSZWYsXG4gICkge31cblxuICBwdWJsaWMgZ2V0IGNhbGVuZGFyTW9udGgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5jYWxlbmRhckRhdGU/LmdldE1vbnRoKCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGNhbGVuZGFyWWVhcigpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmNhbGVuZGFyRGF0ZT8uZ2V0RnVsbFllYXIoKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgY2FsZW5kYXJEYXkoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5jYWxlbmRhckRhdGU/LmdldERhdGUoKTtcbiAgfVxuXG4gIHB1YmxpYyBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gIH1cblxuICBwdWJsaWMgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIHRoaXMuX2NyZWF0ZU1vbnRoc0xpc3QoKTtcbiAgICB0aGlzLl9jcmVhdGVZZWFyc0xpc3QoKTtcbiAgfVxuXG4gIHB1YmxpYyBzZWxlY3RNb250aChtb250aDogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5tb250aENoYW5nZS5lbWl0KG1vbnRoKTtcblxuICAgIHRoaXMuc2V0Vmlld01vZGUoJ2RhdGUnKTtcbiAgfVxuXG4gIHB1YmxpYyBzZWxlY3RZZWFyKHllYXI6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMueWVhckNoYW5nZS5lbWl0KHllYXIpO1xuXG4gICAgdGhpcy5zZXRWaWV3TW9kZSgnZGF0ZScpO1xuICB9XG5cbiAgcHVibGljIHNldFZpZXdNb2RlKG1vZGU6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMudmlld01vZGVDaGFuZ2UuZW1pdChtb2RlKTtcblxuICAgIHRoaXMuX3Njcm9sbFRvU2VsZWN0ZWRZZWFyKCk7XG4gICAgdGhpcy5fc2Nyb2xsVG9TZWxlY3RlZE1vbnRoKCk7XG4gIH1cblxuICBwdWJsaWMgbmV4dE1vbnRoKCk6IHZvaWQge1xuICAgIHRoaXMuZ29OZXh0TW9udGguZW1pdCgpO1xuICB9XG5cbiAgcHVibGljIHByZXZNb250aCgpOiB2b2lkIHtcbiAgICB0aGlzLmdvUHJldk1vbnRoLmVtaXQoKTtcbiAgfVxuXG4gIHByaXZhdGUgX2NyZWF0ZVllYXJzTGlzdCgpOiB2b2lkIHtcbiAgICB0aGlzLnllYXJzTGlzdCA9IFtdO1xuXG4gICAgZm9yIChsZXQgeTogbnVtYmVyID0gdGhpcy5taW5ZZWFyOyB5IDwgdGhpcy5tYXhZZWFyOyB5KyspIHtcbiAgICAgIGNvbnN0IHllYXIgPSBuZXcgRGF0ZSgpLnNldEZ1bGxZZWFyKHkpO1xuICAgICAgdGhpcy55ZWFyc0xpc3QucHVzaCh7IHZhbHVlOiB5LCBkaXNhYmxlZDogdGhpcy5faXNZZWFyRGlzYWJsZWQoeWVhcikgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfY3JlYXRlTW9udGhzTGlzdCgpOiB2b2lkIHtcbiAgICBjb25zdCB5ZWFyID0gdGhpcy5jYWxlbmRhck1vbnRoID8gdGhpcy5jYWxlbmRhclllYXIgOiB0aGlzLm5vdy5nZXRGdWxsWWVhcigpO1xuXG4gICAgY29uc3QgY2hlY2tJZk1vbnRoRGlzYWJsZWQgPSAobW9udGhOdW1iZXI6IG51bWJlciwgZGlzYWJsZWREYXlzKSA9PiB7XG4gICAgICBjb25zdCBtb250aCA9IG5ldyBEYXRlKCk7XG4gICAgICBtb250aC5zZXRGdWxsWWVhcih5ZWFyKTtcbiAgICAgIG1vbnRoLnNldE1vbnRoKG1vbnRoTnVtYmVyKTtcblxuICAgICAgcmV0dXJuIGlzTW9udGhEaXNhYmxlZChtb250aCwgZGlzYWJsZWREYXlzKVxuICAgIH1cblxuICAgIHRoaXMubW9udGhMaXN0ID0gW107XG5cbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgTU9OVEhTKSB7XG4gICAgICBjb25zdCBtb250aEl0ZW0gPSB7XG4gICAgICAgIC4uLml0ZW0sXG4gICAgICAgIGRpc2FibGVkOiBjaGVja0lmTW9udGhEaXNhYmxlZChpdGVtLnZhbHVlLCB0aGlzLmRpc2FibGVkRGF5cyksXG4gICAgICB9XG5cbiAgICAgIHRoaXMubW9udGhMaXN0LnB1c2gobW9udGhJdGVtKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9pc1llYXJEaXNhYmxlZChkYXRlKTogYm9vbGVhbiB7XG4gICAgY29uc3Qgc3RhcnRZZWFyID0gc3RhcnRPZlllYXIoZGF0ZSk7XG4gICAgY29uc3QgZW5kWWVhciA9IGVuZE9mWWVhcihkYXRlKTtcblxuICAgIHJldHVybiBpc1JhbmdlRGlzYWJsZWQodGhpcy5kaXNhYmxlZERheXMsIHN0YXJ0WWVhciwgZW5kWWVhcik7XG4gIH1cblxuICBwcml2YXRlIF9zY3JvbGxUb1NlbGVjdGVkWWVhcigpOiB2b2lkIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNvbnN0IHllYXJzID0gdGhpcy5fZWxSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcueWVhcnMnKTtcbiAgICAgIGNvbnN0IHNlbGVjdGVkID0geWVhcnMucXVlcnlTZWxlY3RvcignLnllYXIuc2VsZWN0ZWQnKTtcblxuICAgICAgaWYgKHNlbGVjdGVkKSB7XG4gICAgICAgIHNlbGVjdGVkLnNjcm9sbEludG9WaWV3KHtiZWhhdmlvcjogJ2F1dG8nLCBibG9jazogJ2NlbnRlcid9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgX3Njcm9sbFRvU2VsZWN0ZWRNb250aCgpOiB2b2lkIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNvbnN0IHllYXJzID0gdGhpcy5fZWxSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcubW9udGhzJyk7XG4gICAgICBjb25zdCBzZWxlY3RlZCA9IHllYXJzLnF1ZXJ5U2VsZWN0b3IoJy5tb250aC5zZWxlY3RlZCcpO1xuXG4gICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgc2VsZWN0ZWQuc2Nyb2xsSW50b1ZpZXcoe2JlaGF2aW9yOiAnYXV0bycsIGJsb2NrOiAnY2VudGVyJ30pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbn1cbiIsIjxkaXYgY2xhc3M9XCJtb250aHMteWVhcnNcIiAqbmdJZj1cInZpZXdNb2RlID09ICdtb250aCcgfHwgdmlld01vZGUgPT0gJ3llYXInXCI+XG4gIDxkaXYgY2xhc3M9XCJtb250aHNcIj5cbiAgICA8ZGl2XG4gICAgICAqbmdGb3I9XCJsZXQgbW9udGggb2YgbW9udGhMaXN0XCJcbiAgICAgIChjbGljayk9XCJzZWxlY3RNb250aChtb250aC52YWx1ZSlcIlxuICAgICAgY2xhc3M9XCJtb250aFwiXG4gICAgICBbbmdDbGFzc109XCJ7XG4gICAgICAgICAgbm93OiBtb250aE5vdyA9PSBtb250aC52YWx1ZSxcbiAgICAgICAgICBzZWxlY3RlZDogY2FsZW5kYXJNb250aCA9PT0gbW9udGgudmFsdWUsXG4gICAgICAgICAgZGlzYWJsZWQ6IG1vbnRoLmRpc2FibGVkXG4gICAgICAgIH1cIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJ0aWxlLWNvbnRlbnRcIj57eyBtb250aC5hYnIgfX08L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG5cbiAgPGRpdiBjbGFzcz1cInllYXJzXCI+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdGb3I9XCJsZXQgeWVhciBvZiB5ZWFyc0xpc3Q7XCI+XG4gICAgICA8ZGl2XG4gICAgICAgIGNsYXNzPVwieWVhciBkYXRhLXllYXIte3sgeWVhci52YWx1ZSB9fVwiXG4gICAgICAgIChjbGljayk9XCJzZWxlY3RZZWFyKHllYXIudmFsdWUpXCJcbiAgICAgICAgW2NsYXNzLm5vd109XCJ5ZWFyTm93ID09IHllYXIudmFsdWVcIlxuICAgICAgICBbY2xhc3Muc2VsZWN0ZWRdPVwiY2FsZW5kYXJZZWFyID09PSB5ZWFyLnZhbHVlXCJcbiAgICAgICAgW2NsYXNzLmRpc2FibGVkXT1cInllYXIuZGlzYWJsZWRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInRpbGUtY29udGVudFwiPnt7IHllYXIudmFsdWUgfX08L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvbmctY29udGFpbmVyPlxuICAgIDxkaXYgY2xhc3M9XCJjbGVhclwiPjwvZGl2PlxuICA8L2Rpdj5cbjwvZGl2PlxuXG48ZGl2ICpuZ0lmPVwidmlld01vZGUgPT0gJ3dlZWsnIHx8IHZpZXdNb2RlID09ICdkYXRlJyB8fCB2aWV3TW9kZSA9PSAnZGF0ZXRpbWUnIHx8IHZpZXdNb2RlID09ICdtb250aHJhbmdlJ1wiIGNsYXNzPVwiY2FsZW5kYXJcIj5cbiAgPGRpdiBjbGFzcz1cIm1vbnRoLXllYXJcIj5cbiAgICA8YSBjbGFzcz1cIm1vbnRoLXllYXItbmFtZVwiIChjbGljayk9XCJzZXRWaWV3TW9kZSgnbW9udGgnKVwiPlxuICAgICAge3sgY2FsZW5kYXJEYXRlIHwgZnNEYXRlRm9ybWF0OiAnZnVsbC1kYXRlLWRheWxlc3MteWVhcmxlc3MnIH19XG5cbiAgICAgIDxzcGFuICpuZ0lmPVwiY2FsZW5kYXJEYXlcIiBjbGFzcz1cImRheS1uYW1lXCI+XG4gICAgICAgIHt7IGNhbGVuZGFyRGF5IH19LFxuICAgICAgPC9zcGFuPlxuXG4gICAgICB7eyBjYWxlbmRhclllYXIgfX1cbiAgICAgIDxtYXQtaWNvbiBjbGFzcz1cImFjdGlvblwiPmFycm93X2Ryb3BfZG93bjwvbWF0LWljb24+XG4gICAgPC9hPlxuXG4gICAgPGRpdiBjbGFzcz1cImdhcFwiPjwvZGl2PlxuXG4gICAgPGRpdiBjbGFzcz1cImFjdGlvblwiPlxuICAgICAgPGEgKGNsaWNrKT1cInByZXZNb250aCgpXCIgY2xhc3M9XCJhY3Rpb25cIj5cbiAgICAgICAgPG1hdC1pY29uPm5hdmlnYXRlX2JlZm9yZTwvbWF0LWljb24+XG4gICAgICA8L2E+XG4gICAgICA8YSAoY2xpY2spPVwibmV4dE1vbnRoKClcIiBjbGFzcz1cImFjdGlvblwiPlxuICAgICAgICA8bWF0LWljb24+bmF2aWdhdGVfbmV4dDwvbWF0LWljb24+XG4gICAgICA8L2E+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuXG48L2Rpdj5cbiJdfQ==