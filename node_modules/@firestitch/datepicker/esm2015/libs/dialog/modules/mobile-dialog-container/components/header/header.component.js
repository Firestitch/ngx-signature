import { ChangeDetectionStrategy, Component, Input, Output, EventEmitter, ElementRef, } from '@angular/core';
import { endOfYear, startOfYear } from 'date-fns';
import { isRangeDisabled } from '../../../../../common/helpers/is-range-disabled';
import { MONTHS } from '../../../../../calendar/consts/months';
import { isMonthDisabled } from '../../../../../common/helpers/is-month-disabled';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
export class FsDatePickerMobileHeaderComponent {
    constructor(_elRef) {
        this._elRef = _elRef;
        this.monthChange = new EventEmitter();
        this.yearChange = new EventEmitter();
        this.goNextMonth = new EventEmitter();
        this.goPrevMonth = new EventEmitter();
        this.viewModeChange = new EventEmitter();
        this.now = new Date();
        this.monthNow = this.now.getMonth();
        this.yearNow = this.now.getFullYear();
        this.yearsList = [];
        this.monthList = [];
    }
    get calendarMonth() {
        var _a;
        return (_a = this.calendarDate) === null || _a === void 0 ? void 0 : _a.getMonth();
    }
    get calendarYear() {
        var _a;
        return (_a = this.calendarDate) === null || _a === void 0 ? void 0 : _a.getFullYear();
    }
    get calendarDay() {
        var _a;
        return (_a = this.calendarDate) === null || _a === void 0 ? void 0 : _a.getDate();
    }
    ngOnChanges(changes) {
    }
    ngAfterViewInit() {
        this._createMonthsList();
        this._createYearsList();
    }
    selectMonth(month) {
        this.monthChange.emit(month);
        this.setViewMode('date');
    }
    selectYear(year) {
        this.yearChange.emit(year);
        this.setViewMode('date');
    }
    setViewMode(mode) {
        this.viewModeChange.emit(mode);
        if (mode === 'year') {
            this._scrollToSelectedYear();
        }
    }
    nextMonth() {
        this.goNextMonth.emit();
    }
    prevMonth() {
        this.goPrevMonth.emit();
    }
    _createYearsList() {
        this.yearsList = [];
        for (let y = this.minYear; y < this.maxYear; y++) {
            const year = new Date().setFullYear(y);
            this.yearsList.push({ value: y, disabled: this._isYearDisabled(year) });
        }
    }
    _createMonthsList() {
        const year = this.calendarMonth ? this.calendarYear : this.now.getFullYear();
        const checkIfMonthDisabled = (monthNumber, disabledDays) => {
            const month = new Date();
            month.setFullYear(year);
            month.setMonth(monthNumber);
            return isMonthDisabled(month, disabledDays);
        };
        this.monthList = [];
        for (const item of MONTHS) {
            const monthItem = Object.assign(Object.assign({}, item), { disabled: checkIfMonthDisabled(item.value, this.disabledDays) });
            this.monthList.push(monthItem);
        }
    }
    _isYearDisabled(date) {
        const startYear = startOfYear(date);
        const endYear = endOfYear(date);
        return isRangeDisabled(this.disabledDays, startYear, endYear);
    }
    _scrollToSelectedYear() {
        setTimeout(() => {
            const years = this._elRef.nativeElement.querySelector('.years');
            const selected = years.querySelector('.year.selected');
            if (selected) {
                years.scrollTop = selected.offsetTop;
            }
        }, 50);
    }
}
FsDatePickerMobileHeaderComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsDatePickerMobileHeaderComponent, deps: [{ token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component });
FsDatePickerMobileHeaderComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: FsDatePickerMobileHeaderComponent, selector: "fs-date-picker-mobile-header", inputs: { viewMode: "viewMode", minYear: "minYear", maxYear: "maxYear", disabledDays: "disabledDays", calendarDate: "calendarDate" }, outputs: { monthChange: "monthChange", yearChange: "yearChange", goNextMonth: "goNextMonth", goPrevMonth: "goPrevMonth", viewModeChange: "viewModeChange" }, usesOnChanges: true, ngImport: i0, template: "<div class=\"months\" *ngIf=\"viewMode == 'month'\">\n  <div\n    *ngFor=\"let month of monthList\"\n    (click)=\"selectMonth(month.value)\"\n    class=\"month\"\n    [ngClass]=\"{\n        now: monthNow == month.value,\n        selected: calendarMonth === month.value,\n        disabled: month.disabled\n      }\">\n    <div class=\"tile-content\">{{ month.abr }}</div>\n  </div>\n</div>\n\n<div class=\"years\" *ngIf=\"viewMode == 'year'\">\n  <ng-container *ngFor=\"let year of yearsList;\">\n    <div\n      class=\"year data-year-{{ year.value }}\"\n      (click)=\"selectYear(year.value)\"\n      [class.now]=\"yearNow == year.value\"\n      [class.selected]=\"calendarYear === year.value\"\n      [class.disabled]=\"year.disabled\">\n      <div class=\"tile-content\">{{ year.value }}</div>\n    </div>\n  </ng-container>\n  <div class=\"clear\"></div>\n</div>\n", styles: [".months{width:350px}.month-year{height:auto;padding:0 15px;justify-content:center}\n"], directives: [{ type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsDatePickerMobileHeaderComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'fs-date-picker-mobile-header',
                    templateUrl: './header.component.html',
                    styleUrls: [
                        './header.component.scss',
                    ],
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }]; }, propDecorators: { viewMode: [{
                type: Input
            }], minYear: [{
                type: Input
            }], maxYear: [{
                type: Input
            }], disabledDays: [{
                type: Input
            }], calendarDate: [{
                type: Input
            }], monthChange: [{
                type: Output
            }], yearChange: [{
                type: Output
            }], goNextMonth: [{
                type: Output
            }], goPrevMonth: [{
                type: Output
            }], viewModeChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVhZGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWJzL2RpYWxvZy9tb2R1bGVzL21vYmlsZS1kaWFsb2ctY29udGFpbmVyL2NvbXBvbmVudHMvaGVhZGVyL2hlYWRlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGlicy9kaWFsb2cvbW9kdWxlcy9tb2JpbGUtZGlhbG9nLWNvbnRhaW5lci9jb21wb25lbnRzL2hlYWRlci9oZWFkZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixTQUFTLEVBQ1QsS0FBSyxFQUlMLE1BQU0sRUFDTixZQUFZLEVBQ1osVUFBVSxHQUNYLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRWxELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxpREFBaUQsQ0FBQztBQUNsRixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDL0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGlEQUFpRCxDQUFDOzs7QUF3QmxGLE1BQU0sT0FBTyxpQ0FBaUM7SUF1QzVDLFlBQ1UsTUFBa0I7UUFBbEIsV0FBTSxHQUFOLE1BQU0sQ0FBWTtRQXRCckIsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBR3pDLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBR3hDLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUd2QyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFRLENBQUM7UUFHdkMsbUJBQWMsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBRW5DLFFBQUcsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ2pCLGFBQVEsR0FBRyxJ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QkFEYixLQUFLO2dCQUlDLFlBQVk7c0JBRGxCLEtBQUs7Z0JBSUMsWUFBWTtzQkFEbEIsS0FBSztnQkFJQyxXQUFXO3NCQURqQixNQUFNO2dCQUlBLFVBQVU7c0JBRGhCLE1BQU07Z0JBSUEsV0FBVztzQkFEakIsTUFBTTtnQkFJQSxXQUFXO3NCQURqQixNQUFNO2dCQUlBLGNBQWM7c0JBRHBCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ29tcG9uZW50LFxuICBJbnB1dCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgT25DaGFuZ2VzLFxuICBTaW1wbGVDaGFuZ2VzLFxuICBPdXRwdXQsXG4gIEV2ZW50RW1pdHRlcixcbiAgRWxlbWVudFJlZixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IGVuZE9mWWVhciwgc3RhcnRPZlllYXIgfSBmcm9tICdkYXRlLWZucyc7XG5cbmltcG9ydCB7IGlzUmFuZ2VEaXNhYmxlZCB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL2NvbW1vbi9oZWxwZXJzL2lzLXJhbmdlLWRpc2FibGVkJztcbmltcG9ydCB7IE1PTlRIUyB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL2NhbGVuZGFyL2NvbnN0cy9tb250aHMnO1xuaW1wb3J0IHsgaXNNb250aERpc2FibGVkIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMvaXMtbW9udGgtZGlzYWJsZWQnO1xuXG5cbmludGVyZmFjZSBJWWVhckxpc3RJdGVtIHtcbiAgdmFsdWU6IG51bWJlcjtcbiAgZGlzYWJsZWQ6IGJvb2xlYW47XG59XG5cbmludGVyZmFjZSBJTW9udGhMaXN0SXRlbSB7XG4gIHZhbHVlOiBudW1iZXI7XG4gIG5hbWU6IHN0cmluZztcbiAgYWJyOiBzdHJpbmc7XG4gIGRpc2FibGVkOiBib29sZWFuO1xufVxuXG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2ZzLWRhdGUtcGlja2VyLW1vYmlsZS1oZWFkZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vaGVhZGVyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbXG4gICAgJy4vaGVhZGVyLmNvbXBvbmVudC5zY3NzJyxcbiAgXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG59KVxuZXhwb3J0IGNsYXNzIEZzRGF0ZVBpY2tlck1vYmlsZUhlYWRlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3SW5pdCB7XG5cbiAgQElucHV0KClcbiAgcHVibGljIHZpZXdNb2RlOiBzdHJpbmc7XG5cbiAgQElucHV0KClcbiAgcHVibGljIG1pblllYXI6IG51bWJlcjtcblxuICBASW5wdXQoKVxuICBwdWJsaWMgbWF4WWVhcjogbnVtYmVyO1xuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBkaXNhYmxlZERheXM6IFtEYXRlLCBEYXRlXVtdO1xuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBjYWxlbmRhckRhdGU6IERhdGU7XG5cbiAgQE91dHB1dCgpXG4gIHB1YmxpYyBtb250aENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xuXG4gIEBPdXRwdXQoKVxuICBwdWJsaWMgeWVhckNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xuXG4gIEBPdXRwdXQoKVxuICBwdWJsaWMgZ29OZXh0TW9udGggPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cbiAgQE91dHB1dCgpXG4gIHB1YmxpYyBnb1ByZXZNb250aCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICBAT3V0cHV0KClcbiAgcHVibGljIHZpZXdNb2RlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG5cbiAgcHVibGljIHJlYWRvbmx5IG5vdyA9IG5ldyBEYXRlKCk7XG4gIHB1YmxpYyByZWFkb25seSBtb250aE5vdyA9IHRoaXMubm93LmdldE1vbnRoKCk7XG4gIHB1YmxpYyByZWFkb25seSB5ZWFyTm93ID0gdGhpcy5ub3cuZ2V0RnVsbFllYXIoKTtcblxuICBwdWJsaWMgeWVhcnNMaXN0OiBJWWVhckxpc3RJdGVtW10gPSBbXTtcbiAgcHVibGljIG1vbnRoTGlzdDogSU1vbnRoTGlzdEl0ZW1bXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgX2VsUmVmOiBFbGVtZW50UmVmLFxuICApIHt9XG5cbiAgcHVibGljIGdldCBjYWxlbmRhck1vbnRoKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuY2FsZW5kYXJEYXRlPy5nZXRNb250aCgpO1xuICB9XG5cbiAgcHVibGljIGdldCBjYWxlbmRhclllYXIoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5jYWxlbmRhckRhdGU/LmdldEZ1bGxZZWFyKCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGNhbGVuZGFyRGF5KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuY2FsZW5kYXJEYXRlPy5nZXREYXRlKCk7XG4gIH1cblxuICBwdWJsaWMgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICB9XG5cbiAgcHVibGljIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLl9jcmVhdGVNb250aHNMaXN0KCk7XG4gICAgdGhpcy5fY3JlYXRlWWVhcnNMaXN0KCk7XG4gIH1cblxuICBwdWJsaWMgc2VsZWN0TW9udGgobW9udGg6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMubW9udGhDaGFuZ2UuZW1pdChtb250aCk7XG5cbiAgICB0aGlzLnNldFZpZXdNb2RlKCdkYXRlJyk7XG4gIH1cblxuICBwdWJsaWMgc2VsZWN0WWVhcih5ZWFyOiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLnllYXJDaGFuZ2UuZW1pdCh5ZWFyKTtcblxuICAgIHRoaXMuc2V0Vmlld01vZGUoJ2RhdGUnKTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRWaWV3TW9kZShtb2RlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLnZpZXdNb2RlQ2hhbmdlLmVtaXQobW9kZSk7XG5cbiAgICBpZiAobW9kZSA9PT0gJ3llYXInKSB7XG4gICAgICB0aGlzLl9zY3JvbGxUb1NlbGVjdGVkWWVhcigpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBuZXh0TW9udGgoKTogdm9pZCB7XG4gICAgdGhpcy5nb05leHRNb250aC5lbWl0KCk7XG4gIH1cblxuICBwdWJsaWMgcHJldk1vbnRoKCk6IHZvaWQge1xuICAgIHRoaXMuZ29QcmV2TW9udGguZW1pdCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBfY3JlYXRlWWVhcnNMaXN0KCk6IHZvaWQge1xuICAgIHRoaXMueWVhcnNMaXN0ID0gW107XG5cbiAgICBmb3IgKGxldCB5OiBudW1iZXIgPSB0aGlzLm1pblllYXI7IHkgPCB0aGlzLm1heFllYXI7IHkrKykge1xuICAgICAgY29uc3QgeWVhciA9IG5ldyBEYXRlKCkuc2V0RnVsbFllYXIoeSk7XG4gICAgICB0aGlzLnllYXJzTGlzdC5wdXNoKHsgdmFsdWU6IHksIGRpc2FibGVkOiB0aGlzLl9pc1llYXJEaXNhYmxlZCh5ZWFyKSB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9jcmVhdGVNb250aHNMaXN0KCk6IHZvaWQge1xuICAgIGNvbnN0IHllYXIgPSB0aGlzLmNhbGVuZGFyTW9udGggPyB0aGlzLmNhbGVuZGFyWWVhciA6IHRoaXMubm93LmdldEZ1bGxZZWFyKCk7XG5cbiAgICBjb25zdCBjaGVja0lmTW9udGhEaXNhYmxlZCA9IChtb250aE51bWJlcjogbnVtYmVyLCBkaXNhYmxlZERheXMpID0+IHtcbiAgICAgIGNvbnN0IG1vbnRoID0gbmV3IERhdGUoKTtcbiAgICAgIG1vbnRoLnNldEZ1bGxZZWFyKHllYXIpO1xuICAgICAgbW9udGguc2V0TW9udGgobW9udGhOdW1iZXIpO1xuXG4gICAgICByZXR1cm4gaXNNb250aERpc2FibGVkKG1vbnRoLCBkaXNhYmxlZERheXMpXG4gICAgfVxuXG4gICAgdGhpcy5tb250aExpc3QgPSBbXTtcblxuICAgIGZvciAoY29uc3QgaXRlbSBvZiBNT05USFMpIHtcbiAgICAgIGNvbnN0IG1vbnRoSXRlbSA9IHtcbiAgICAgICAgLi4uaXRlbSxcbiAgICAgICAgZGlzYWJsZWQ6IGNoZWNrSWZNb250aERpc2FibGVkKGl0ZW0udmFsdWUsIHRoaXMuZGlzYWJsZWREYXlzKSxcbiAgICAgIH1cblxuICAgICAgdGhpcy5tb250aExpc3QucHVzaChtb250aEl0ZW0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX2lzWWVhckRpc2FibGVkKGRhdGUpOiBib29sZWFuIHtcbiAgICBjb25zdCBzdGFydFllYXIgPSBzdGFydE9mWWVhcihkYXRlKTtcbiAgICBjb25zdCBlbmRZZWFyID0gZW5kT2ZZZWFyKGRhdGUpO1xuXG4gICAgcmV0dXJuIGlzUmFuZ2VEaXNhYmxlZCh0aGlzLmRpc2FibGVkRGF5cywgc3RhcnRZZWFyLCBlbmRZZWFyKTtcbiAgfVxuXG4gIHByaXZhdGUgX3Njcm9sbFRvU2VsZWN0ZWRZZWFyKCk6IHZvaWQge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY29uc3QgeWVhcnMgPSB0aGlzLl9lbFJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy55ZWFycycpO1xuICAgICAgY29uc3Qgc2VsZWN0ZWQgPSB5ZWFycy5xdWVyeVNlbGVjdG9yKCcueWVhci5zZWxlY3RlZCcpO1xuXG4gICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgeWVhcnMuc2Nyb2xsVG9wID0gc2VsZWN0ZWQub2Zmc2V0VG9wO1xuICAgICAgfVxuICAgIH0sIDUwKTtcbiAgfVxuXG59XG4iLCI8ZGl2IGNsYXNzPVwibW9udGhzXCIgKm5nSWY9XCJ2aWV3TW9kZSA9PSAnbW9udGgnXCI+XG4gIDxkaXZcbiAgICAqbmdGb3I9XCJsZXQgbW9udGggb2YgbW9udGhMaXN0XCJcbiAgICAoY2xpY2spPVwic2VsZWN0TW9udGgobW9udGgudmFsdWUpXCJcbiAgICBjbGFzcz1cIm1vbnRoXCJcbiAgICBbbmdDbGFzc109XCJ7XG4gICAgICAgIG5vdzogbW9udGhOb3cgPT0gbW9udGgudmFsdWUsXG4gICAgICAgIHNlbGVjdGVkOiBjYWxlbmRhck1vbnRoID09PSBtb250aC52YWx1ZSxcbiAgICAgICAgZGlzYWJsZWQ6IG1vbnRoLmRpc2FibGVkXG4gICAgICB9XCI+XG4gICAgPGRpdiBjbGFzcz1cInRpbGUtY29udGVudFwiPnt7IG1vbnRoLmFiciB9fTwvZGl2PlxuICA8L2Rpdj5cbjwvZGl2PlxuXG48ZGl2IGNsYXNzPVwieWVhcnNcIiAqbmdJZj1cInZpZXdNb2RlID09ICd5ZWFyJ1wiPlxuICA8bmctY29udGFpbmVyICpuZ0Zvcj1cImxldCB5ZWFyIG9mIHllYXJzTGlzdDtcIj5cbiAgICA8ZGl2XG4gICAgICBjbGFzcz1cInllYXIgZGF0YS15ZWFyLXt7IHllYXIudmFsdWUgfX1cIlxuICAgICAgKGNsaWNrKT1cInNlbGVjdFllYXIoeWVhci52YWx1ZSlcIlxuICAgICAgW2NsYXNzLm5vd109XCJ5ZWFyTm93ID09IHllYXIudmFsdWVcIlxuICAgICAgW2NsYXNzLnNlbGVjdGVkXT1cImNhbGVuZGFyWWVhciA9PT0geWVhci52YWx1ZVwiXG4gICAgICBbY2xhc3MuZGlzYWJsZWRdPVwieWVhci5kaXNhYmxlZFwiPlxuICAgICAgPGRpdiBjbGFzcz1cInRpbGUtY29udGVudFwiPnt7IHllYXIudmFsdWUgfX08L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9uZy1jb250YWluZXI+XG4gIDxkaXYgY2xhc3M9XCJjbGVhclwiPjwvZGl2PlxuPC9kaXY+XG4iXX0=