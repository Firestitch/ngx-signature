import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, EventEmitter, Inject, Input, Output, Renderer2, } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { getDaysInMonth, isValid } from 'date-fns';
import { MONTHS } from '../../consts/months';
import * as i0 from "@angular/core";
import * as i1 from "@firestitch/scroll-picker";
import * as i2 from "@angular/common";
import * as i3 from "@angular/forms";
export class FsDateScrollPickerDialogComponent {
    constructor(element, _cdRef, _renderer, _document) {
        this.element = element;
        this._cdRef = _cdRef;
        this._renderer = _renderer;
        this._document = _document;
        this.changed = new EventEmitter();
        this.years = [];
        this.months = [];
        this.maxDay = 0;
    }
    ngOnInit() {
        const modelValue = this.model;
        this._generateYearsArray();
        this._generateMonthArray();
        this._generateDaysArray();
        if (modelValue && isValid(modelValue)) {
            this._setDate(modelValue);
        }
        else {
            const date = new Date();
            if (!this.showDay) {
                date.setDate(1);
            }
            if (!this.showMonth) {
                date.setMonth(1);
            }
            if (!this.showYear) {
                date.setFullYear(0);
            }
            this._setDate(date);
        }
        this._pullToRefreshDisable();
    }
    ngOnDestroy() {
        this._pullToRefreshDefault();
    }
    _setDate(date) {
        if (date) {
            this.day = date.getDate();
            this.year = date.getFullYear();
            this.month = date.getMonth();
        }
    }
    _getMonth(month) {
        return this.months.find(item => {
            return month === item.value;
        });
    }
    change() {
        if (!this.year) {
            this.year = this.showYear ? this.years[0] : 0;
        }
        if (!this.month) {
            this.month = this.months[0].value;
        }
        if (!this.day) {
            this.day = 1;
        }
        const daysInMonth = getDaysInMonth(new Date(this.year, this.month));
        if (this.day > daysInMonth) {
            this.day = daysInMonth;
        }
        const date = new Date(this.year, this.month, this.day);
        this.changed.emit(date);
        this._cdRef.markForCheck();
    }
    changeMonth() {
        this._generateDaysArray();
        this.change();
    }
    changeYear() {
        this._generateDaysArray();
        if (this.maxDate) {
            this._generateMonthArray();
        }
        this.change();
    }
    _generateDaysArray() {
        this.maxDay = 0;
        const maxDate = this.maxDate;
        const maxDay = maxDate && maxDate.getDate();
        const maxMonth = maxDate && maxDate.getMonth();
        const maxYear = maxDate && maxDate.getFullYear();
        if (this.month) {
            if (maxDay && maxMonth == this.month.value && maxYear === this.year) {
                this.maxDay = maxDay;
            }
            else {
                const daysInMonth = getDaysInMonth(new Date(this.year, this.month));
                this.maxDay = daysInMonth;
            }
        }
        if (!this.maxDay) {
            this.maxDay = 31;
        }
    }
    _generateMonthArray() {
        this.months = MONTHS;
    }
    _generateYearsArray() {
        let minYear = this.minYear;
        let maxYear = this.maxYear;
        if (!maxYear) {
            const today = new Date();
            maxYear = today.getFullYear();
        }
        for (minYear; minYear <= maxYear; minYear++) {
            this.years.push({ name: minYear, value: minYear });
        }
    }
    _pullToRefreshDisable() {
        this._renderer.addClass(this._document.body, 'fs-date-picker-prevent-pull-to-refresh');
    }
    _pullToRefreshDefault() {
        this._renderer.removeClass(this._document.body, 'fs-date-picker-prevent-pull-to-refresh');
    }
}
FsDateScrollPickerDialogComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsDateScrollPickerDialogComponent, deps: [{ token: i0.ElementRef }, { token: i0.ChangeDetectorRef }, { token: i0.Renderer2 }, { token: DOCUMENT }], target: i0.ɵɵFactoryTarget.Component });
FsDateScrollPickerDialogComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: FsDateScrollPickerDialogComponent, selector: "fs-date-scroll-picker", inputs: { model: "model", showMonth: "showMonth", showDay: "showDay", showYear: "showYear", minYear: "minYear", maxYear: "maxYear", maxDate: "maxDate" }, outputs: { changed: "changed" }, ngImport: i0, template: "<div class=\"scroll-pickers\">\n  <fs-scroll-picker\n    *ngIf=\"showMonth\"\n    class=\"month\"\n    [values]=\"months\"\n    name=\"month\"\n    [(ngModel)]=\"month\"\n    (ngModelChange)=\"changeMonth()\">\n  </fs-scroll-picker>\n\n  <fs-scroll-picker\n      *ngIf=\"showDay\"\n      class=\"day\"\n      [valuesMin]=\"1\"\n      [valuesMax]=\"maxDay\"\n      name=\"day\"\n      [(ngModel)]=\"day\"\n      (ngModelChange)=\"change()\">\n  </fs-scroll-picker>\n\n  <fs-scroll-picker\n      *ngIf=\"showYear\"\n      class=\"year\"\n      [values]=\"years\"\n      name=\"year\"\n      [(ngModel)]=\"year\"\n      (ngModelChange)=\"changeYear()\">\n  </fs-scroll-picker>\n</div>", styles: [".scroll-pickers{display:flex;flex-direction:row;justify-content:center;background:#fff}.scroll-pickers fs-scroll-picker.day{width:80px}.scroll-pickers fs-scroll-picker.month{width:150px}.scroll-pickers fs-scroll-picker.year{width:100px}\n"], components: [{ type: i1.ScrollPickerComponent, selector: "fs-scroll-picker", inputs: ["values", "valuesMin", "valuesMax", "width"] }], directives: [{ type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i3.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i3.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: FsDateScrollPickerDialogComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'fs-date-scroll-picker',
                    templateUrl: './date-scroll-picker.component.html',
                    styleUrls: ['./date-scroll-picker.component.scss'],
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.ChangeDetectorRef }, { type: i0.Renderer2 }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }]; }, propDecorators: { model: [{
                type: Input
            }], showMonth: [{
                type: Input
            }], showDay: [{
                type: Input
            }], showYear: [{
                type: Input
            }], minYear: [{
                type: Input
            }], maxYear: [{
                type: Input
            }], maxDate: [{
                type: Input
            }], changed: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1zY3JvbGwtcGlja2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWJzL2RpYWxvZy9tb2R1bGVzL3Njcm9sbC1waWNrZXItZGlhbG9nLWNvbnRhaW5lci9jb21wb25lbnRzL2RhdGUtc2Nyb2xsLXBpY2tlci9kYXRlLXNjcm9sbC1waWNrZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2xpYnMvZGlhbG9nL21vZHVsZXMvc2Nyb2xsLXBpY2tlci1kaWFsb2ctY29udGFpbmVyL2NvbXBvbmVudHMvZGF0ZS1zY3JvbGwtcGlja2VyL2RhdGUtc2Nyb2xsLXBpY2tlci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixNQUFNLEVBQ04sS0FBSyxFQUdMLE1BQU0sRUFDTixTQUFTLEdBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRTNDLE9BQU8sRUFBRSxjQUFjLEVBQUUsT0FBTyxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBR25ELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQzs7Ozs7QUFTN0MsTUFBTSxPQUFPLGlDQUFpQztJQWtDNUMsWUFDUyxPQUFtQixFQUNsQixNQUF5QixFQUN6QixTQUFvQixFQUVwQixTQUFTO1FBSlYsWUFBTyxHQUFQLE9BQU8sQ0FBWTtRQUNsQixXQUFNLEdBQU4sTUFBTSxDQUFtQjtRQUN6QixjQUFTLEdBQVQsU0FBUyxDQUFXO1FBRXBCLGNBQVMsR0FBVCxTQUFTLENBQUE7UUFmWixZQUFPLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUVuQyxVQUFLLEdBQVUsRUFBRSxDQUFD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Q0FuQ1gsS0FBSztzQkFEWCxLQUFLO2dCQUlDLFNBQVM7c0JBRGYsS0FBSztnQkFJQyxPQUFPO3NCQURiLEtBQUs7Z0JBSUMsUUFBUTtzQkFEZCxLQUFLO2dCQUlDLE9BQU87c0JBRGIsS0FBSztnQkFJQyxPQUFPO3NCQURiLEtBQUs7Z0JBSUMsT0FBTztzQkFEYixLQUFLO2dCQUlDLE9BQU87c0JBRGIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIEluamVjdCxcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFJlbmRlcmVyMixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBET0NVTUVOVCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5cbmltcG9ydCB7IGdldERheXNJbk1vbnRoLCBpc1ZhbGlkIH0gZnJvbSAnZGF0ZS1mbnMnO1xuXG5cbmltcG9ydCB7IE1PTlRIUyB9IGZyb20gJy4uLy4uL2NvbnN0cy9tb250aHMnO1xuXG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2ZzLWRhdGUtc2Nyb2xsLXBpY2tlcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9kYXRlLXNjcm9sbC1waWNrZXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9kYXRlLXNjcm9sbC1waWNrZXIuY29tcG9uZW50LnNjc3MnXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG59KVxuZXhwb3J0IGNsYXNzIEZzRGF0ZVNjcm9sbFBpY2tlckRpYWxvZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcblxuICBASW5wdXQoKVxuICBwdWJsaWMgbW9kZWw6IERhdGUgfCBudWxsO1xuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzaG93TW9udGg6IGJvb2xlYW47XG5cbiAgQElucHV0KClcbiAgcHVibGljIHNob3dEYXk6IGJvb2xlYW47XG5cbiAgQElucHV0KClcbiAgcHVibGljIHNob3dZZWFyOiBib29sZWFuO1xuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBtaW5ZZWFyOiBudW1iZXI7XG5cbiAgQElucHV0KClcbiAgcHVibGljIG1heFllYXI6IG51bWJlcjtcblxuICBASW5wdXQoKVxuICBwdWJsaWMgbWF4RGF0ZTogRGF0ZTtcblxuICBAT3V0cHV0KClcbiAgcHVibGljIGNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPERhdGU+KCk7XG5cbiAgcHVibGljIHllYXJzOiBhbnlbXSA9IFtdO1xuICBwdWJsaWMgbW9udGhzOiBhbnlbXSA9IFtdO1xuXG4gIHB1YmxpYyBtb250aDtcbiAgcHVibGljIGRheTtcbiAgcHVibGljIHllYXI7XG4gIHB1YmxpYyBtYXhEYXkgPSAwO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBlbGVtZW50OiBFbGVtZW50UmVmLFxuICAgIHByaXZhdGUgX2NkUmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcml2YXRlIF9yZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIEBJbmplY3QoRE9DVU1FTlQpXG4gICAgcHJpdmF0ZSBfZG9jdW1lbnQsXG4gICkge31cblxuICBwdWJsaWMgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgY29uc3QgbW9kZWxWYWx1ZTogRGF0ZSA9IHRoaXMubW9kZWw7XG5cbiAgICB0aGlzLl9nZW5lcmF0ZVllYXJzQXJyYXkoKTtcbiAgICB0aGlzLl9nZW5lcmF0ZU1vbnRoQXJyYXkoKTtcbiAgICB0aGlzLl9nZW5lcmF0ZURheXNBcnJheSgpO1xuXG4gICAgaWYgKG1vZGVsVmFsdWUgJiYgaXNWYWxpZChtb2RlbFZhbHVlKSkge1xuICAgICAgdGhpcy5fc2V0RGF0ZShtb2RlbFZhbHVlKTtcbiAgICB9IGVsc2Uge1xuXG4gICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoKTtcblxuICAgICAgaWYgKCF0aGlzLnNob3dEYXkpIHtcbiAgICAgICAgZGF0ZS5zZXREYXRlKDEpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXRoaXMuc2hvd01vbnRoKSB7XG4gICAgICAgIGRhdGUuc2V0TW9udGgoMSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghdGhpcy5zaG93WWVhcikge1xuICAgICAgICBkYXRlLnNldEZ1bGxZZWFyKDApO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9zZXREYXRlKGRhdGUpO1xuICAgIH1cblxuICAgIHRoaXMuX3B1bGxUb1JlZnJlc2hEaXNhYmxlKCk7XG4gIH1cblxuICBwdWJsaWMgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5fcHVsbFRvUmVmcmVzaERlZmF1bHQoKTtcbiAgfVxuXG4gIHByaXZhdGUgX3NldERhdGUoZGF0ZTogRGF0ZSkge1xuICAgIGlmIChkYXRlKSB7XG4gICAgICB0aGlzLmRheSA9IGRhdGUuZ2V0RGF0ZSgpO1xuICAgICAgdGhpcy55ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xuICAgICAgdGhpcy5tb250aCA9IGRhdGUuZ2V0TW9udGgoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9nZXRNb250aChtb250aCkge1xuICAgIHJldHVybiB0aGlzLm1vbnRocy5maW5kKGl0ZW0gPT4ge1xuICAgICAgcmV0dXJuIG1vbnRoID09PSBpdGVtLnZhbHVlO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGNoYW5nZSgpIHtcbiAgICBpZiAoIXRoaXMueWVhcikge1xuICAgICAgdGhpcy55ZWFyID0gdGhpcy5zaG93WWVhciA/IHRoaXMueWVhcnNbMF0gOiAwO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5tb250aCkge1xuICAgICAgdGhpcy5tb250aCA9IHRoaXMubW9udGhzWzBdLnZhbHVlO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5kYXkpIHtcbiAgICAgIHRoaXMuZGF5ID0gMTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgZGF5c0luTW9udGggPSBnZXREYXlzSW5Nb250aChuZXcgRGF0ZSh0aGlzLnllYXIsIHRoaXMubW9udGgpKTtcbiAgICBpZiAodGhpcy5kYXkgPiBkYXlzSW5Nb250aCkge1xuICAgICAgdGhpcy5kYXkgPSBkYXlzSW5Nb250aDtcbiAgICB9XG5cbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodGhpcy55ZWFyLCB0aGlzLm1vbnRoLCB0aGlzLmRheSk7XG5cbiAgICB0aGlzLmNoYW5nZWQuZW1pdChkYXRlKTtcbiAgICB0aGlzLl9jZFJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgfVxuXG4gIHB1YmxpYyBjaGFuZ2VNb250aCgpIHtcbiAgICB0aGlzLl9nZW5lcmF0ZURheXNBcnJheSgpO1xuICAgIHRoaXMuY2hhbmdlKCk7XG4gIH1cblxuICBwdWJsaWMgY2hhbmdlWWVhcigpIHtcbiAgICB0aGlzLl9nZW5lcmF0ZURheXNBcnJheSgpO1xuICAgIGlmICh0aGlzLm1heERhdGUpIHtcbiAgICAgIHRoaXMuX2dlbmVyYXRlTW9udGhBcnJheSgpO1xuICAgIH1cbiAgICB0aGlzLmNoYW5nZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBfZ2VuZXJhdGVEYXlzQXJyYXkoKSB7XG4gICAgdGhpcy5tYXhEYXkgPSAwO1xuICAgIGNvbnN0IG1heERhdGUgPSB0aGlzLm1heERhdGU7XG4gICAgY29uc3QgbWF4RGF5ID0gbWF4RGF0ZSAmJiBtYXhEYXRlLmdldERhdGUoKTtcbiAgICBjb25zdCBtYXhNb250aCA9IG1heERhdGUgJiYgbWF4RGF0ZS5nZXRNb250aCgpO1xuICAgIGNvbnN0IG1heFllYXIgPSBtYXhEYXRlICYmIG1heERhdGUuZ2V0RnVsbFllYXIoKTtcblxuICAgIGlmICh0aGlzLm1vbnRoKSB7XG4gICAgICBpZiAobWF4RGF5ICYmIG1heE1vbnRoID09IHRoaXMubW9udGgudmFsdWUgJiYgbWF4WWVhciA9PT0gdGhpcy55ZWFyKSB7XG4gICAgICAgIHRoaXMubWF4RGF5ID0gbWF4RGF5O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgZGF5c0luTW9udGggPSBnZXREYXlzSW5Nb250aChuZXcgRGF0ZSh0aGlzLnllYXIsIHRoaXMubW9udGgpKTtcbiAgICAgICAgdGhpcy5tYXhEYXkgPSBkYXlzSW5Nb250aDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIXRoaXMubWF4RGF5KSB7XG4gICAgICB0aGlzLm1heERheSA9IDMxO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX2dlbmVyYXRlTW9udGhBcnJheSgpIHtcbiAgICB0aGlzLm1vbnRocyA9IE1PTlRIUztcbiAgfVxuXG4gIHByaXZhdGUgX2dlbmVyYXRlWWVhcnNBcnJheSgpIHtcbiAgICBsZXQgbWluWWVhciA9IHRoaXMubWluWWVhcjtcbiAgICBsZXQgbWF4WWVhciA9IHRoaXMubWF4WWVhcjtcblxuICAgIGlmICghbWF4WWVhcikge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpO1xuICAgICAgbWF4WWVhciA9IHRvZGF5LmdldEZ1bGxZZWFyKCk7XG4gICAgfVxuXG4gICAgIGZvciAoIG1pblllYXI7IG1pblllYXIgPD0gbWF4WWVhcjsgbWluWWVhcisrICkge1xuICAgICAgIHRoaXMueWVhcnMucHVzaCh7IG5hbWU6IG1pblllYXIsIHZhbHVlOiBtaW5ZZWFyIH0pO1xuICAgICB9XG4gIH1cblxuICBwcml2YXRlIF9wdWxsVG9SZWZyZXNoRGlzYWJsZSgpOiB2b2lkIHtcbiAgICB0aGlzLl9yZW5kZXJlci5hZGRDbGFzcyh0aGlzLl9kb2N1bWVudC5ib2R5LCAnZnMtZGF0ZS1waWNrZXItcHJldmVudC1wdWxsLXRvLXJlZnJlc2gnKTtcbiAgfVxuXG4gIHByaXZhdGUgX3B1bGxUb1JlZnJlc2hEZWZhdWx0KCk6IHZvaWQge1xuICAgIHRoaXMuX3JlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMuX2RvY3VtZW50LmJvZHksICdmcy1kYXRlLXBpY2tlci1wcmV2ZW50LXB1bGwtdG8tcmVmcmVzaCcpO1xuICB9XG5cbn1cbiIsIjxkaXYgY2xhc3M9XCJzY3JvbGwtcGlja2Vyc1wiPlxuICA8ZnMtc2Nyb2xsLXBpY2tlclxuICAgICpuZ0lmPVwic2hvd01vbnRoXCJcbiAgICBjbGFzcz1cIm1vbnRoXCJcbiAgICBbdmFsdWVzXT1cIm1vbnRoc1wiXG4gICAgbmFtZT1cIm1vbnRoXCJcbiAgICBbKG5nTW9kZWwpXT1cIm1vbnRoXCJcbiAgICAobmdNb2RlbENoYW5nZSk9XCJjaGFuZ2VNb250aCgpXCI+XG4gIDwvZnMtc2Nyb2xsLXBpY2tlcj5cblxuICA8ZnMtc2Nyb2xsLXBpY2tlclxuICAgICAgKm5nSWY9XCJzaG93RGF5XCJcbiAgICAgIGNsYXNzPVwiZGF5XCJcbiAgICAgIFt2YWx1ZXNNaW5dPVwiMVwiXG4gICAgICBbdmFsdWVzTWF4XT1cIm1heERheVwiXG4gICAgICBuYW1lPVwiZGF5XCJcbiAgICAgIFsobmdNb2RlbCldPVwiZGF5XCJcbiAgICAgIChuZ01vZGVsQ2hhbmdlKT1cImNoYW5nZSgpXCI+XG4gIDwvZnMtc2Nyb2xsLXBpY2tlcj5cblxuICA8ZnMtc2Nyb2xsLXBpY2tlclxuICAgICAgKm5nSWY9XCJzaG93WWVhclwiXG4gICAgICBjbGFzcz1cInllYXJcIlxuICAgICAgW3ZhbHVlc109XCJ5ZWFyc1wiXG4gICAgICBuYW1lPVwieWVhclwiXG4gICAgICBbKG5nTW9kZWwpXT1cInllYXJcIlxuICAgICAgKG5nTW9kZWxDaGFuZ2UpPVwiY2hhbmdlWWVhcigpXCI+XG4gIDwvZnMtc2Nyb2xsLXBpY2tlcj5cbjwvZGl2PiJdfQ==